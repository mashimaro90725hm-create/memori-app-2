<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memori - è¨€å¶è€ƒå¤å­¦</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* --- ğŸ¨ æ ¸å¿ƒ UI æ ·å¼ä¸ä¸­å›½è‰² (å¤åˆ»è‡ª App.vue) --- */
        :root {
            --color-bg-main: #E2E1E4; --color-text-main: #2D241E; --color-accent: #CB3A56;
            --color-accent-hover: #EF7A82; --glass-bg: rgba(255, 253, 248, 0.75); --glass-border: rgba(203, 58, 86, 0.15);
        }
        * { box-sizing: border-box; }
        body { margin: 0; min-height: 100vh; overflow: hidden; font-family: 'Zen Old Mincho', serif; }

        /* ğŸšª å°é¢å¸ƒå±€ä¿®å¤ï¼šç¼©å°çŒ«å’ªï¼Œç¡®ä¿ä¸æŒ¡æŒ‰é’® */
        .cover-stage { position: fixed; inset: 0; background-size: cover; background-position: center; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .cover-overlay-gradient { position: absolute; inset: 0; background: linear-gradient(to right, rgba(45,36,30,0.6), rgba(45,36,30,0.2) 60%, transparent); }
        .cover-content-layout { position: relative; z-index: 2; width: 90%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; height: 80vh; }
        
        .cover-cat-wrapper { 
            flex: 0 0 35%; /* ç¼©å°çŒ«å’ªå æ¯” */
            height: 100%; display: flex; align-items: flex-end; 
            z-index: 1; pointer-events: none; /* å½»åº•ç§»é™¤ç‚¹å‡»åˆ¤å®š */
        }
        .cover-cat-large { 
            max-width: 100%; max-height: 70vh; /* è°ƒå°é«˜åº¦ */
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.6)); transform: scaleX(-1) translateX(-10%); 
        }
        
        .cover-text-group.jp-style { 
            flex: 1; text-align: right; padding-right: 50px; color: white; 
            z-index: 50; /* æå‡æ–‡å­—ä¸æŒ‰é’®å±‚çº§ */
        }
        .start-btn-main.jp-btn { 
            margin-top: 50px; padding: 16px 54px; background: var(--color-accent); 
            border: none; border-radius: 4px; color: white; font-weight: bold; 
            cursor: pointer; pointer-events: auto; transition: transform 0.3s;
            box-shadow: 0 4px 20px rgba(203, 58, 86, 0.4);
        }

        /* ğŸ›ï¸ ä¸»åº”ç”¨ç•Œé¢ (ä¹å›½è¾å…¸ + æŸ´çŠ¬å®šä½) */
        .app-container { display: flex; width: 100vw; height: 100vh; position: relative; }
        .sidebar { width: 280px; padding: 25px; z-index: 20; background: var(--glass-bg); backdrop-filter: blur(20px); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; }
        .main-stage { flex: 1; padding: 25px; display: flex; flex-direction: column; z-index: 10; overflow-y: auto; }
        
        .shiba-mascot { position: absolute; bottom: 180px; right: 25px; width: 130px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .shiba-img { width: 100%; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2)); }
        .cat-mascot-fixed { position: fixed; bottom: 30px; right: 30px; width: 220px; z-index: 100; cursor: pointer; transform: scaleX(-1); transition: transform 0.3s; }

        /* 3D å¡ç‰‡ç³»ç»Ÿ */
        .card-3d-wrapper { width: 400px; height: 600px; perspective: 1500px; margin: 40px auto; }
        .card-body { width: 100%; height: 100%; transition: 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; position: relative; }
        .card-body.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 24px; background: #F3F2F0; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--glass-border); }
        .card-face.back { transform: rotateY(180deg); background: rgba(255,253,248,0.95); }

        /* å†å²å¤§äº‹å¹´è¡¨ (Timeline) */
        .history-stage { flex: 1; padding: 40px; background: var(--glass-bg); border-radius: 24px; position: relative; overflow-y: auto; }
        .timeline-spine { position: absolute; left: 100px; top: 0; bottom: 0; width: 3px; background: var(--color-accent); opacity: 0.3; }
        
        .fade-enter-active, .fade-leave-active { transition: opacity 0.8s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>
    <div id="app">
        <transition name="fade">
            <div v-if="showCover" class="cover-stage" style="background-image: url('./cover-bg.jpg');">
                <div class="cover-overlay-gradient"></div>
                <div class="cover-content-layout">
                    <div class="cover-cat-wrapper">
                        <img src="./cover-cat.png" class="cover-cat-large" alt="Cover Cat">
                    </div>
                    <div class="cover-text-group jp-style">
                        <h1 style="font-family: 'Cinzel', serif; font-size: 5rem; font-weight: 700;">Memori</h1>
                        <p style="font-family: 'Noto Serif JP', serif; font-size: 1.5rem; letter-spacing: 0.3em; margin-top: 15px;">è¨€è‘‰ã®è€ƒå¤å­¦</p>
                        <div style="margin-top: 50px; font-family: 'Zen Old Mincho', serif; line-height: 2.2; opacity: 0.9;">
                            <p>æ™‚ã®ç ‚ã«åŸ‹ã‚‚ã‚ŒãŸã€</p>
                            <p>è¨€è‘‰ã®æ¬ ç‰‡ã‚’æ¢ã—ã¦ã€‚</p>
                        </div>
                        <button class="start-btn-main jp-btn" @click="enterApp">æ¢ç´¢ã‚’å§‹ã‚ã‚‹</button>
                    </div>
                </div>
            </div>
        </transition>

        <div v-if="!showCover" class="app-container" :style="{ background: langConfig[currentLang].bg }">
            <aside class="sidebar">
                <div class="mb-8">
                    <h3 class="text-xl font-bold" :style="{ color: langConfig[currentLang].accent }">
                        {{ langConfig[currentLang].flag }} {{ langConfig[currentLang].name }}
                    </h3>
                </div>
                
                <div class="word-list flex-1 overflow-y-auto pr-2">
                    <div v-for="item in filteredHistory" :key="item.id" 
                         @click="loadWord(item)"
                         class="p-4 mb-3 rounded-xl cursor-pointer bg-white/50 hover:bg-white transition-all border border-transparent hover:border-red-100">
                        <div class="font-bold">{{ item.word }}</div>
                        <div class="text-xs text-gray-400">{{ item.reading }}</div>
                    </div>
                </div>

                <div class="mt-4 pt-4 border-t border-red-100 flex flex-col gap-2">
                    <button @click="mode = 'gallery'" class="w-full p-3 rounded-xl bg-white border hover:shadow-md">è—å“é¦†</button>
                    <button @click="mode = 'history'" class="w-full p-3 rounded-xl bg-white border hover:shadow-md">å†å²å¹´è¡¨</button>
                    <button @click="startReview" class="w-full p-3 rounded-xl bg-red-700 text-white shadow-lg hover:bg-red-800">å¤ä¹ å•è¯</button>
                </div>
            </aside>

            <main class="main-stage">
                <div class="search-bar flex bg-white/70 backdrop-blur rounded-full p-2 mb-8 border border-red-100 shadow-sm">
                    <div class="flex gap-3 px-4 border-r border-red-100">
                        <button v-for="(cfg, key) in langConfig" :key="key" 
                                @click="switchLang(key)"
                                :class="{'opacity-100 scale-125': currentLang === key, 'opacity-30': currentLang !== key}"
                                class="transition-all hover:opacity-100">
                            {{ cfg.flag }}
                        </button>
                    </div>
                    <input v-model="wordInput" @keyup.enter="generateCard" 
                           :placeholder="langConfig[currentLang].scent + 'çš„å‘³é“...'" 
                           class="flex-1 bg-transparent px-6 outline-none text-lg">
                    <button @click="generateCard" class="px-6 text-red-700 hover:scale-110 transition-transform">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                </div>

                <div v-if="mode === 'gallery'" class="card-3d-wrapper" @click="isFlipped = !isFlipped">
                    <div class="card-body" :class="{ 'is-flipped': isFlipped }">
                        <div class="card-face front">
                            <img :src="card.imageUrl" class="w-full h-3/5 object-cover">
                            <div class="p-8 text-center flex-1 flex flex-col justify-center">
                                <h2 class="text-5xl font-bold mb-4" :style="{ color: langConfig[currentLang].accent }">{{ card.word }}</h2>
                                <p class="text-gray-500 italic">{{ card.reading }}</p>
                                <div class="mt-6 flex justify-center gap-4">
                                    <button @click.stop="speak(card.word)" class="p-3 bg-gray-100 rounded-full hover:bg-red-50 text-red-700">ğŸ”Š</button>
                                </div>
                            </div>
                        </div>
                        <div class="card-face back p-10 overflow-y-auto">
                            <h3 class="text-2xl font-bold mb-6 border-b-2 pb-2" :style="{ borderColor: langConfig[currentLang].accent }">è€ƒå¤è¯æº</h3>
                            <p class="leading-loose text-lg mb-8">{{ card.etymology }}</p>
                            <div class="bg-red-50 p-6 rounded-2xl border-l-4 border-red-700">
                                <strong class="text-red-900">é‡Šä¹‰ï¼š</strong>{{ card.meaning }}
                            </div>
                        </div>
                    </div>
                </div>

                <div v-else-if="mode === 'history'" class="history-stage">
                    <h2 class="text-3xl font-bold mb-10 flex items-center gap-4">
                        <i class="fa-solid fa-scroll text-red-700"></i> å†å²å¤§äº‹å¹´è¡¨
                    </h2>
                    <div class="relative pl-32">
                        <div class="timeline-spine"></div>
                        <div v-for="item in timelines[historyTab]" :key="item.id" class="mb-16 relative">
                            <div class="absolute -left-32 w-24 text-right font-bold text-red-700 text-xl">{{ item.year }}</div>
                            <div class="bg-white p-8 rounded-3xl shadow-sm border border-red-50 hover:shadow-xl transition-shadow relative">
                                <span class="text-3xl absolute -left-4 -top-4 bg-white p-2 rounded-full border shadow-sm">{{ item.tag }}</span>
                                <p class="text-xl leading-relaxed">{{ item.event }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <div class="shiba-mascot" @click="pokeMascot">
                <img :src="shibaImages[neroState]" class="shiba-img" alt="Nero">
                <div v-if="neroState === 'happy'" class="absolute -top-12 left-1/2 -translate-x-1/2 bg-white px-4 py-2 rounded-full shadow-lg border border-red-100">é¦™ï¼âœ¨</div>
            </div>
            <img src="./my-cat.png" @click="pokeMascot" class="cat-mascot-fixed hover:scale-110" alt="Mascot">
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        createApp({
            setup() {
                const showCover = ref(true);
                const currentLang = ref('jp');
                const wordInput = ref('');
                const neroState = ref('idle');
                const isFlipped = ref(false);
                const mode = ref('gallery');
                const historyTab = ref('asia');
                const history = ref(JSON.parse(localStorage.getItem('memori-book') || '[]'));
                const card = ref({ word: 'Memori', reading: 'me-mo-ri', meaning: 'æ¬¢è¿å›åˆ°è¯­è¨€è€ƒå¤å‘æ˜ç°åœº', etymology: 'åœ¨è¿™ç‰‡æ–‡å­—çš„åœ°å±‚ä¸‹ï¼Œæ¯ä¸€å—ç¢ç‰‡éƒ½è®°å½•ç€ä¸€æ®µæ¶ˆå¤±çš„æ–‡æ˜ã€‚', imageUrl: './cover-bg.jpg' });

                const shibaImages = { idle: './shiba/idle.gif', thinking: './shiba/run.gif', happy: './shiba/happy.gif' };
                const langConfig = {
                    jp: { name: 'æ—¥è¯­', flag: 'ğŸ‡¯ğŸ‡µ', accent: '#CB3A56', scent: 'æ¨±ä¸å’Œçº¸', bg: '#F9F1F0' },
                    zh: { name: 'æ±‰è¯­', flag: 'ğŸ‡¨ğŸ‡³', accent: '#9D2933', scent: 'æœ±ç ‚ä¸èŒ¶', bg: '#FBF8F1' },
                    en: { name: 'è‹±è¯­', flag: 'ğŸ‡¬ğŸ‡§', accent: '#1772B4', scent: 'ç¾Šçš®å·', bg: '#EDF1F4' },
                    lzh: { name: 'å¤æ±‰è¯­', flag: 'ğŸ“œ', accent: '#41555D', scent: 'æª€é¦™', bg: '#E9EAE4' },
                    cjp: { name: 'å¤æ—¥æ–‡', flag: 'ğŸ¯', accent: '#5A3D30', scent: 'æ¯å¢¨', bg: '#F2EFE8' },
                    kr: { name: 'éŸ©è¯­', flag: 'ğŸ‡°ğŸ‡·', accent: '#B25D7E', scent: 'æœ¨æ§¿', bg: '#F9EDF1' },
                    de: { name: 'å¾·è¯­', flag: 'ğŸ‡©ğŸ‡ª', accent: '#374E59', scent: 'é»‘æ£®æ—', bg: '#EFF2F1' },
                    it: { name: 'æ„è¯­', flag: 'ğŸ‡®ğŸ‡¹', accent: '#8E4932', scent: 'æ‰˜æ–¯å¡çº³', bg: '#FAF6EE' },
                    lat: { name: 'æ‹‰ä¸', flag: 'ğŸ›ï¸', accent: '#605A54', scent: 'ä¹³é¦™', bg: '#F0EEEC' }
                };

                const timelines = {
                    asia: [{ id: 1, year: 'å‰7000', event: 'æ²³å§†æ¸¡æ–‡åŒ–ï¼šå‘ç°ä¸–ç•Œä¸Šæœ€æ—©çš„äººå·¥æ ½åŸ¹æ°´ç¨»ã€‚', tag: 'ğŸŒ¾' }, { id: 2, year: 'å‰221', event: 'ç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œä¹¦åŒæ–‡ï¼Œè½¦åŒè½¨ã€‚', tag: 'ğŸ®' }, { id: 3, year: '710', event: 'å¹³åŸäº¬è¿éƒ½ï¼Œå¥ˆè‰¯æ—¶ä»£å¼€å¯ï¼Œé£å”ä½¿é¢‘ç¹å¾€æ¥ã€‚', tag: 'ğŸ¯' }]
                };

                const filteredHistory = computed(() => history.value.filter(h => h.lang === currentLang.value));
                const enterApp = () => showCover.value = false;

                // å¯¹æ¥äº‘ç«¯ API
                async function generateCard() {
                    if (!wordInput.value) return;
                    neroState.value = 'thinking';
                    try {
                        const response = await fetch(`/api/openai?word=${encodeURIComponent(wordInput.value)}&lang=${currentLang.value}`);
                        const data = await response.json();
                        card.value = { 
                            ...data, 
                            lang: currentLang.value,
                            imageUrl: `https://pollinations.ai/p/ancient_manuscript_artifact_${encodeURIComponent(data.word)}?width=800&height=1000&nologo=true`
                        };
                        history.value.unshift({...card.value, id: Date.now()});
                        localStorage.setItem('memori-book', JSON.stringify(history.value));
                        neroState.value = 'happy'; setTimeout(() => neroState.value = 'idle', 3000);
                        wordInput.value = ''; isFlipped.value = false; mode.value = 'gallery';
                    } catch (e) { alert('å‘æ˜ä¸­æ–­ï¼Œè¯·æ£€æŸ¥ API è¿æ¥'); neroState.value = 'idle'; }
                }

                const switchLang = (lang) => { currentLang.value = lang; mode.value = 'gallery'; };
                const loadWord = (item) => { card.value = item; isFlipped.value = false; mode.value = 'gallery'; };
                const pokeMascot = () => { neroState.value = 'happy'; setTimeout(() => neroState.value = 'idle', 1500); };
                const speak = (text) => { const u = new SpeechSynthesisUtterance(text); u.lang = currentLang.value === 'jp' ? 'ja-JP' : 'en-US'; window.speechSynthesis.speak(u); };

                return { showCover, currentLang, wordInput, history, filteredHistory, card, mode, historyTab, timelines, langConfig, shibaImages, neroState, isFlipped, enterApp, generateCard, switchLang, loadWord, pokeMascot, speak };
            }
        }).mount('#app');
    </script>
</body>
</html>
