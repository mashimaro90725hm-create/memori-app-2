<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memori - è¨€å¶è€ƒå¤å­¦</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* --- ğŸ® å®Œæ•´çš„ä¸­å›½è‰²ä¸»é¢˜ä¸ UI æ ·å¼ (å¤åˆ»è‡ª App.vue Style) --- */
        :root {
            --color-bg-main: #E2E1E4; --color-text-main: #2D241E; --color-accent: #CB3A56;
            --color-accent-hover: #EF7A82; --glass-bg: rgba(255, 253, 248, 0.75); --glass-border: rgba(203, 58, 86, 0.15);
        }
        * { box-sizing: border-box; }
        body { margin: 0; min-height: 100vh; overflow: hidden; font-family: 'Zen Old Mincho', serif; }

        /* ä¿®å¤å°é¢ç‚¹å‡»ï¼šçŒ«å’ªåœ¨ä¸‹ï¼ŒæŒ‰é’®åœ¨ä¸Š */
        .cover-stage { position: fixed; inset: 0; background-size: cover; background-position: center; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .cover-overlay-gradient { position: absolute; inset: 0; background: linear-gradient(to right, rgba(45,36,30,0.6), transparent); }
        .cover-cat-wrapper { flex: 1; height: 100%; display: flex; align-items: flex-end; z-index: 1; pointer-events: none; }
        .cover-cat-large { max-height: 90vh; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.6)); transform: scaleX(-1) translateX(-10%); }
        .cover-text-group { flex: 1; text-align: right; padding-right: 50px; color: white; z-index: 10; }
        .start-btn { margin-top: 50px; padding: 16px 48px; background: var(--color-accent); border: none; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; pointer-events: auto; }

        /* ä¸»åº”ç”¨å¸ƒå±€ */
        .app-container { display: flex; width: 100vw; height: 100vh; position: relative; }
        .sidebar { width: 280px; padding: 20px; z-index: 20; background: var(--glass-bg); backdrop-filter: blur(20px); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; }
        .main-stage { flex: 1; padding: 20px; display: flex; flex-direction: column; z-index: 10; }
        
        /* æŸ´çŠ¬ä¸çŒ«å’ªå®šä½ (Shiba & Cat) */
        .shiba-mascot { position: absolute; bottom: 180px; right: 20px; width: 130px; cursor: pointer; text-align: center; }
        .shiba-img { width: 100%; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2)); }
        .cat-mascot-fixed { position: fixed; bottom: 30px; right: 30px; width: 250px; z-index: 100; cursor: pointer; transform: scaleX(-1); }

        /* 3D å¡ç‰‡ä¸ SRS è®°å¿†ç³»ç»Ÿæ ·å¼ */
        .card-3d-wrapper { width: 400px; height: 600px; perspective: 1500px; margin: auto; }
        .card-body { width: 100%; height: 100%; transition: 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; position: relative; }
        .card-body.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 24px; background: #F3F2F0; overflow: hidden; }
        .card-face.back { transform: rotateY(180deg); background: rgba(255,253,248,0.9); }
        
        /* å†å²å¹´è¡¨ä¸“å±æ ·å¼ */
        .history-stage { flex: 1; padding: 35px; background: var(--glass-bg); border-radius: 24px; margin: 20px; overflow-y: auto; }
        .timeline-spine { position: absolute; left: 95px; top: 0; bottom: 0; width: 3px; background: var(--color-accent); opacity: 0.4; }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 3px; }
    </style>
</head>
<body>
    <div id="app">
        <transition name="fade">
            <div v-if="showCover" class="cover-stage" style="background-image: url('./cover-bg.jpg');">
                <div class="cover-overlay-gradient"></div>
                <div class="cover-content-layout">
                    <div class="cover-cat-wrapper"><img src="./cover-cat.png" class="cover-cat-large"></div>
                    <div class="cover-text-group">
                        <h1 style="font-size: 5rem; font-family: 'Cinzel';">Memori</h1>
                        <p style="letter-spacing: 0.3em; font-size: 1.5rem;">è¨€è‘‰ã®è€ƒå¤å­¦</p>
                        <button class="start-btn" @click="showCover = false">æ¢ç´¢ã‚’å§‹ã‚ã‚‹</button>
                    </div>
                </div>
            </div>
        </transition>

        <div v-if="!showCover" class="app-container" :style="{ background: langConfig[currentLang].bg, fontFamily: langConfig[currentLang].font }">
            <aside class="sidebar">
                <h3 :style="{ color: langConfig[currentLang].accent }">{{ langConfig[currentLang].flag }} {{ langConfig[currentLang].name }}</h3>
                <div class="word-list custom-scroll" style="flex:1;">
                    <div v-for="item in filteredHistory" :key="item.id" class="p-3 mb-2 rounded-lg cursor-pointer bg-white/50" @click="loadWord(item)">{{ item.word }}</div>
                </div>
                <div class="sidebar-footer">
                    <button class="w-full p-3 mb-2 bg-red-700 text-white rounded-xl" @click="startReview">å¤ä¹ </button>
                    <button class="w-full p-3 mb-2 border rounded-xl" @click="mode = 'gallery'">è—å“é¦†</button>
                    <button class="w-full p-3 border rounded-xl" @click="mode = 'history'">å†å²å¹´è¡¨</button>
                </div>
            </aside>

            <main class="main-stage">
                <div class="search-bar p-4 mb-6 flex bg-white/60 rounded-full border border-red-100">
                    <div class="flex gap-2 mr-4 border-r pr-4">
                        <button v-for="(cfg, key) in langConfig" :key="key" @click="switchLang(key)" :class="{'opacity-100 scale-110': currentLang === key, 'opacity-40': currentLang !== key}">{{ cfg.flag }}</button>
                    </div>
                    <input v-model="wordInput" @keyup.enter="generateCard" :placeholder="langConfig[currentLang].scent + 'çš„å‘³é“...'" class="flex-1 bg-transparent outline-none">
                </div>

                <div v-if="mode === 'card'" class="card-3d-wrapper" @click="isFlipped = !isFlipped">
                    <div class="card-body" :class="{ 'is-flipped': isFlipped }">
                        <div class="card-face front">
                            <img :src="card.imageUrl" class="w-full h-1/2 object-cover">
                            <div class="p-8 text-center">
                                <h2 class="text-5xl mb-4" :style="{ color: langConfig[currentLang].accent }">{{ card.word }}</h2>
                                <p class="text-xl text-gray-500">{{ card.reading }}</p>
                                <button class="mt-8 p-3 rounded-full bg-gray-100" @click.stop="speak(card.word)">ğŸ”Š</button>
                            </div>
                        </div>
                        <div class="card-face back p-8">
                            <h3 class="text-2xl font-bold mb-4">è€ƒå¤è¯æº</h3>
                            <p class="leading-relaxed mb-6">{{ card.etymology }}</p>
                            <div class="bg-red-50 p-4 rounded-xl border-l-4 border-red-700">ä¹‰é¡¹ï¼š{{ card.meaning }}</div>
                        </div>
                    </div>
                </div>

                <div v-else-if="mode === 'history'" class="history-stage">
                    <h2 class="text-3xl font-bold mb-6">å†å²å¤§äº‹å¹´è¡¨</h2>
                    <div class="flex gap-4 mb-8">
                        <button @click="historyTab = 'asia'" :class="{'border-b-2 border-red-700': historyTab === 'asia'}">äºšæ´²å²</button>
                        <button @click="historyTab = 'europe'" :class="{'border-b-2 border-red-700': historyTab === 'europe'}">æ¬§æ´²å²</button>
                    </div>
                    <div class="relative pl-32">
                        <div class="timeline-spine"></div>
                        <div v-for="item in timelines[historyTab]" :key="item.id" class="mb-12 relative">
                            <div class="absolute -left-32 w-24 text-right font-bold text-red-700">{{ item.year }}</div>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border">{{ item.tag }} {{ item.event }}</div>
                        </div>
                    </div>
                </div>
            </main>

            <div class="shiba-mascot" @click="pokeMascot">
                <img :src="shibaImages[neroState]" class="shiba-img">
                <div v-if="neroState === 'happy'" class="absolute -top-10 bg-white p-2 rounded shadow">é¦™ï¼</div>
            </div>
            <img src="./my-cat.png" class="cat-mascot-fixed" alt="Mascot">
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        createApp({
            setup() {
                const showCover = ref(true);
                const currentLang = ref('jp');
                const wordInput = ref('');
                const loading = ref(false);
                const neroState = ref('idle');
                const isFlipped = ref(false);
                const mode = ref('card');
                const history = ref(JSON.parse(localStorage.getItem('memori-book') || '[]'));
                const historyTab = ref('asia');
                const card = ref({ word: 'Memori', reading: 'me-mo-ri', meaning: 'æ¬¢è¿æ¥åˆ°è¯­è¨€è€ƒå¤å‘æ˜ç°åœº', etymology: 'è¯­è¨€çš„å°˜åŸƒä¸­è•´è—ç€æ–‡æ˜çš„çœŸè°›ã€‚', imageUrl: './cover-bg.jpg' });

                // å›¾ç‰‡èµ„æºä¸è¯­è¨€é…ç½®å¤åˆ»
                const shibaImages = { idle: './shiba/idle.gif', thinking: './shiba/run.gif', happy: './shiba/happy.gif' };
                const langConfig = {
                    jp: { name: 'æ—¥è¯­', flag: 'ğŸ‡¯ğŸ‡µ', accent: '#CB3A56', scent: 'æ¨±ä¸å’Œçº¸', bg: '#F9F1F0' },
                    zh: { name: 'ç°ä»£æ±‰è¯­', flag: 'ğŸ‡¨ğŸ‡³', accent: '#9D2933', scent: 'æœ±ç ‚ä¸èŒ¶', bg: '#FBF8F1' },
                    lzh: { name: 'å¤ä»£æ±‰è¯­', flag: 'ğŸ“œ', accent: '#41555D', scent: 'æª€é¦™', bg: '#E9EAE4' },
                    en: { name: 'è‹±è¯­', flag: 'ğŸ‡¬ğŸ‡§', accent: '#1772B4', scent: 'ç¾Šçš®å·', bg: '#EDF1F4' },
                    cjp: { name: 'å¤å…¸æ—¥è¯­', flag: 'ğŸ¯', accent: '#5A3D30', scent: 'æ¯å¢¨', bg: '#F2EFE8' },
                    kr: { name: 'éŸ©è¯­', flag: 'ğŸ‡°ğŸ‡·', accent: '#B25D7E', scent: 'æœ¨æ§¿', bg: '#F9EDF1' },
                    de: { name: 'å¾·è¯­', flag: 'ğŸ‡©ğŸ‡ª', accent: '#374E59', scent: 'é»‘æ£®æ—', bg: '#EFF2F1' },
                    it: { name: 'æ„è¯­', flag: 'ğŸ‡®ğŸ‡¹', accent: '#8E4932', scent: 'æ‰˜æ–¯å¡çº³', bg: '#FAF6EE' },
                    lat: { name: 'æ‹‰ä¸', flag: 'ğŸ›ï¸', accent: '#605A54', scent: 'ä¹³é¦™', bg: '#F0EEEC' }
                };

                const timelines = ref({
                    asia: [{ id: 1, year: 'å‰7000', event: 'æ²³å§†æ¸¡æ–‡åŒ–', tag: 'ğŸº' }, { id: 2, year: 'å‰221', event: 'ç§¦å§‹çš‡ç»Ÿä¸€', tag: 'ğŸ®' }],
                    europe: [{ id: 3, year: 'å‰753', event: 'ç½—é©¬å»ºåŸ', tag: 'ğŸ›ï¸' }]
                });

                const filteredHistory = computed(() => history.value.filter(h => h.lang === currentLang.value));

                // æ ¸å¿ƒï¼šè¿æ¥æ‚¨çš„ 2.0 åç«¯
                async function generateCard() {
                    if (!wordInput.value) return;
                    loading.value = true; neroState.value = 'thinking';
                    try {
                        const response = await fetch(`/api/openai?word=${encodeURIComponent(wordInput.value)}&lang=${currentLang.value}`);
                        const data = await response.json();
                        card.value = { ...data, lang: currentLang.value, imageUrl: `https://pollinations.ai/p/ancient_manuscript_artifact_${encodeURIComponent(data.word)}?width=800&height=1000&nologo=true` };
                        history.value.unshift({...card.value, id: Date.now()});
                        localStorage.setItem('memori-book', JSON.stringify(history.value));
                        neroState.value = 'happy'; setTimeout(() => neroState.value = 'idle', 3000);
                        wordInput.value = ''; isFlipped.value = false; mode.value = 'card';
                    } catch (e) { alert('æŒ–æ˜å¤±è´¥'); neroState.value = 'idle'; }
                }

                const switchLang = (lang) => { currentLang.value = lang; mode.value = 'card'; };
                const loadWord = (item) => { card.value = item; isFlipped.value = false; mode.value = 'card'; };
                const pokeMascot = () => { neroState.value = 'happy'; setTimeout(() => neroState.value = 'idle', 1500); };
                const speak = (text) => { const u = new SpeechSynthesisUtterance(text); u.lang = currentLang.value === 'jp' ? 'ja-JP' : 'en-US'; window.speechSynthesis.speak(u); };

                return { showCover, currentLang, wordInput, history, filteredHistory, card, mode, historyTab, timelines, langConfig, shibaImages, neroState, isFlipped, generateCard, switchLang, loadWord, pokeMascot, speak };
            }
        }).mount('#app');
    </script>
</body>
</html>
