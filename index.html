<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¿†æ – Â· Memori</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
/* --- ğŸ¨ Memori Design System v44.0 (å¤åˆ»ç‰ˆ) --- */
:root {
  --color-bg-main: #E2E1E4; [cite: 1]
  --color-text-main: #2D241E; [cite: 2]
  --color-accent: #CB3A56; [cite: 2]
  --color-accent-hover: #EF7A82; [cite: 3]
  --glass-bg: rgba(255, 253, 248, 0.75); [cite: 3]
  --glass-border: rgba(203, 58, 86, 0.15); [cite: 4]
}

* { box-sizing: border-box; } [cite: 4]

.app-container { 
    display: flex; width: 100vw; height: 100vh; overflow: hidden; 
    position: relative; color: var(--color-text-main); transition: background 0.5s; [cite: 5, 6]
}
.app-container::before { 
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E"); 
    pointer-events: none; z-index: 0; mix-blend-mode: multiply; [cite: 7, 8]
}

.glass-morphism { 
    background: var(--glass-bg); backdrop-filter: blur(20px) saturate(110%); border: 1px solid var(--glass-border);
    box-shadow: 0 4px 12px -1px rgba(45, 36, 30, 0.08); border-radius: 24px; [cite: 8, 9, 10]
}

/* ğŸšª å°é¢é¡µ (å®Œå…¨å¤åˆ» index.txt) */
.cover-stage.classic-theme { 
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
    background-size: cover; background-position: center; display: flex; 
    justify-content: center; align-items: center; z-index: 1000; overflow: hidden; [cite: 10, 11]
}
.cover-overlay-gradient { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
    background: linear-gradient(to right, rgba(45, 36, 30, 0.6) 0%, rgba(45, 36, 30, 0.2) 60%, transparent 100%); [cite: 11, 12]
}
.cover-content-layout { position: relative; z-index: 2; width: 90%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; height: 80vh; [cite: 13] }
.cover-text-group.jp-style { flex: 1; color: #f8f4e6; text-shadow: 0 2px 10px rgba(0,0,0,0.6); padding-left: 50px; text-align: right; z-index: 50; [cite: 14] }
.cover-title-main { font-family: 'Zen Old Mincho', serif; font-size: 5rem; font-weight: 700; margin: 0; letter-spacing: 0.05em; color: #fff; [cite: 15] }
.subtitle-main { font-family: 'Noto Serif JP', serif; font-size: 1.5rem; font-weight: 500; letter-spacing: 0.3em; margin-top: 15px; color: #E2E1E4; [cite: 16] }
.start-btn-main.jp-btn { 
    margin-top: 60px; font-family: 'Noto Serif JP', serif; padding: 16px 48px; font-size: 1.2rem; 
    background: linear-gradient(135deg, var(--color-accent) 0%, #A62C45 100%); color: #fff; border: none; 
    border-radius: 4px; cursor: pointer; transition: all 0.4s; z-index: 100; [cite: 17, 18, 19, 20]
}
.cover-cat-wrapper { flex: 0 0 40%; height: 100%; display: flex; justify-content: flex-start; align-items: flex-end; z-index: 1; pointer-events: none; [cite: 21, 22] }
.cover-cat-large { max-width: 100%; max-height: 75vh; object-fit: contain; transform: translateX(-10%) scaleX(-1); [cite: 22, 23] }

/* Sidebar */
.sidebar { width: 280px; display: flex; flex-direction: column; padding: 30px 20px; z-index: 20; margin: 20px 0 20px 20px; } [cite: 24, 25]
.word-item { padding: 14px 18px; margin-bottom: 10px; border-radius: 16px; cursor: pointer; transition: all 0.2s; background: rgba(255, 253, 248, 0.5); display: flex; justify-content: space-between; } [cite: 29, 30]
.word-item.active { background: white; border-left: 4px solid var(--color-accent); box-shadow: 0 4px 12px rgba(45, 36, 30, 0.08); } [cite: 30, 31]

/* Main Stage */
.main-stage { flex: 1; position: relative; display: flex; flex-direction: column; padding: 20px; z-index: 10; } [cite: 57]
.search-bar { margin: 0 20px 25px; padding: 12px 25px; display: flex; align-items: center; z-index: 50; } [cite: 58]
.lang-pill { width: 36px; height: 36px; border-radius: 12px; background: rgba(255, 253, 248, 0.5); cursor: pointer; display: flex; align-items: center; justify-content: center; margin-right: 8px; } [cite: 59, 60]
.lang-pill.active { background: white; transform: scale(1.1); border: 1px solid var(--glass-border); } [cite: 61]

/* Card 3D */
.card-3d-wrapper { width: 400px; height: 600px; perspective: 1500px; cursor: pointer; margin: auto; } [cite: 88]
.card-body { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; } [cite: 89]
.card-body.is-flipped { transform: rotateY(180deg); } [cite: 89]
.card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: #fffdf9; border-radius: 24px; display: flex; flex-direction: column; overflow: hidden; } [cite: 90]
.main-word { font-size: 3.2rem; font-family: 'Zen Old Mincho', serif; text-align: center; margin: 20px 0; } [cite: 100, 101]

/* Timeline (å®Œå…¨å¤åˆ») */
.history-stage { flex: 1; margin: 0 20px 20px; padding: 35px; display: flex; flex-direction: column; overflow: hidden; } [cite: 133]
.timeline-spine { position: absolute; left: 95px; top: 0; bottom: 0; width: 3px; opacity: 0.4; border-radius: 1.5px; } [cite: 150]
.year-number { font-weight: 800; font-size: 1.2rem; background: rgba(255, 253, 248, 0.95); padding: 4px 8px; border-radius: 6px; } [cite: 152, 153]

/* Mascot (å›ºå®š280px) */
.cat-mascot-container { position: fixed; bottom: 30px; right: 30px; width: 280px; height: 280px; z-index: 100; pointer-events: none; } [cite: 46]
.cat-mascot-img { width: 100%; height: 100%; object-fit: contain; transform: scaleX(-1); } [cite: 47, 48]

/* Garden (å»ç™½æ··åˆæ¨¡å¼) */
.plant-img { position: absolute; bottom: 0; mix-blend-mode: multiply; transition: transform 0.3s; }

.fade-enter-active, .fade-leave-active { transition: opacity 1s ease; } [cite: 23, 24]
.fade-enter-from, .fade-leave-to { opacity: 0; } [cite: 24]
    </style>
</head>
<body>
    <div id="app">
        <Transition name="fade">
            <div v-if="showCover" class="cover-stage classic-theme" :style="{ backgroundImage: \`url(\${coverImages.bg})\` }">
                <div class="cover-overlay-gradient"></div>
                <div class="cover-content-layout">
                    <div class="cover-cat-wrapper"><img :src="coverImages.cat" class="cover-cat-large" alt="Cover Cat"></div>
                    <div class="cover-text-group jp-style">
                        <h1 class="cover-title-main">Memori</h1>
                        <p class="subtitle-main">è¨€è‘‰ã®è€ƒå¤å­¦</p>
                        <div class="poem-main"><p>æ™‚ã®ç ‚ã«åŸ‹ã‚‚ã‚ŒãŸã€</p><p>è¨€è‘‰ã®æ¬ ç‰‡ã‚’æ¢ã—ã¦ã€‚</p></div>
                        <button class="start-btn-main jp-btn" @click="enterApp">æ¢ç´¢ã‚’å§‹ã‚ã‚‹</button>
                    </div>
                </div>
            </div>
        </Transition>

        <div v-if="!showCover" class="app-container" :style="{ background: langConfig[currentLang].bg }">
            <aside class="sidebar glass-morphism">
                <div class="sidebar-header">
                    <h3 :style="{ color: langConfig[currentLang].accent }">ğŸ® {{ langConfig[currentLang].name }} <span>{{ filteredHistory.length }} è¯</span></h3>
                    <button @click="showImport = true" class="text-xs opacity-50 hover:opacity-100">å¯¼å…¥ç¦»çº¿åº“</button>
                </div>
                <div class="word-list custom-scroll">
                    <div v-for="item in filteredHistory" :key="item.id" class="word-item" :class="{ active: card && item.id === card.id }" @click="loadWord(item)">
                        <span>{{ item.word }}</span>
                        <i v-if="item.isLocal" class="fa-solid fa-scroll text-[10px] opacity-40"></i>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <button class="action-btn primary" @click="mode = 'review'" :style="{ background: langConfig[currentLang].accent }">å¤ä¹ è®°å¿†</button>
                    <button class="action-btn outline" @click="mode = 'garden'">è®°å¿†èŠ±ç”°</button>
                    <button class="action-btn outline" @click="mode = 'history'">å†å²å¹´è¡¨</button>
                </div>
            </aside>

            <main class="main-stage">
                <div class="search-bar glass-morphism">
                    <div class="flex">
                        <button v-for="(cfg, key) in langConfig" :key="key" @click="currentLang = key" class="lang-pill" :class="{ active: currentLang === key }">{{ cfg.flag }}</button>
                    </div>
                    <input v-model="wordInput" @keyup.enter="handleSearch" class="flex-1 bg-transparent px-4 outline-none" :placeholder="\`å¯»è§…\${langConfig[currentLang].name}...\`" />
                    <button @click="handleSearch" class="text-xl" :style="{ color: langConfig[currentLang].accent }"><i class="fa-solid fa-magnifying-glass"></i></button>
                </div>

                <div class="flex-1 relative overflow-hidden">
                    <div v-if="mode === 'card'" class="card-3d-wrapper" @click="isFlipped = !isFlipped">
                        <div class="card-body" :class="{ 'is-flipped': isFlipped }">
                            <div class="card-face">
                                <div class="p-10 flex flex-col items-center justify-center h-full">
                                    <div v-if="card.pinyin" class="text-red-800 opacity-60 mb-[-10px]">{{ card.pinyin }}</div>
                                    <h2 class="main-word">{{ card.word }}</h2>
                                    <div class="opacity-50 italic mb-6">{{ card.reading }}</div>
                                    <div class="text-lg border-t pt-6 w-full text-center">{{ card.meaning }}</div>
                                </div>
                            </div>
                            <div class="card-face back p-8 custom-scroll">
                                <div class="mb-6"><span class="text-xs font-bold text-red-800 block mb-2 uppercase tracking-widest">è¯æºè€ƒæ®</span><p>{{ card.etymology }}</p></div>
                                <div v-if="card.examples && card.examples.length"><span class="text-xs font-bold text-red-800 block mb-2 uppercase tracking-widest">å…¸ç±ä¾‹å¥</span>
                                    <div v-for="ex in card.examples" class="mb-4 p-3 bg-black/5 rounded-lg border-l-4 border-red-800">
                                        <p class="italic mb-1" @click.stop="speak(ex.text)">{{ ex.text }}</p><p class="text-sm opacity-60">{{ ex.cn }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-else-if="mode === 'history'" class="history-stage glass-morphism">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-2xl font-bold" :style="{ color: langConfig[currentLang].accent }">å†å²å¤§äº‹å¹´è¡¨</h1>
                            <div class="flex gap-4">
                                <button :class="{ 'font-bold': historyTab === 'asia' }" @click="historyTab = 'asia'">ğŸŒ äºšæ´²</button>
                                <button :class="{ 'font-bold': historyTab === 'europe' }" @click="historyTab = 'europe'">ğŸ›ï¸ æ¬§æ´²å²</button>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto pr-4 custom-scroll relative">
                            <div class="timeline-spine" :style="{ background: langConfig[currentLang].accent }"></div>
                            <div v-for="group in groupedTimelines" :key="group.year" class="flex gap-8 mb-10 relative">
                                <div class="w-24 text-right sticky top-0 pt-2"><span class="year-number" :style="{ color: langConfig[currentLang].accent }">{{ group.year }}</span></div>
                                <div class="flex-1 space-y-4">
                                    <div v-for="event in group.events" class="p-4 bg-white/60 rounded-xl border border-red-800/10 hover:translate-x-1 transition-transform">
                                        <div class="flex items-center gap-2 mb-1"><span>{{ event.tag }}</span><span v-for="t in event.tags" class="text-[10px] px-2 bg-black/5 rounded">{{ t }}</span></div>
                                        <p>{{ event.event }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-else-if="mode === 'garden'" class="h-full relative overflow-hidden bg-white/20 rounded-3xl border border-red-800/5">
                        <div v-for="p in gardenPlants" :key="p.id" class="plant-img" :style="{ left: p.x + '%', bottom: p.y + '%', width: p.size + 'px', zIndex: p.zIndex }">
                            <img :src="p.src" class="w-full" />
                        </div>
                    </div>
                </div>
            </main>

            <div class="cat-mascot-container"><img :src="userCat" class="cat-mascot-img" /></div>
        </div>

        <div v-if="showImport" class="fixed inset-0 bg-black/40 backdrop-blur flex items-center justify-center z-[5000]">
            <div class="bg-white p-8 rounded-3xl w-96">
                <h3 class="text-xl font-bold mb-6">æŒ‚è½½ç¦»çº¿è¾å…¸</h3>
                <select v-model="importLang" class="w-full p-3 border rounded-xl mb-4">
                    <option v-for="(v,k) in langConfig" :value="k">{{ v.name }}</option>
                </select>
                <input type="file" ref="dictFile" class="mb-6 block w-full" accept=".json" />
                <div class="flex gap-4"><button @click="doImport" class="flex-1 bg-red-800 text-white py-3 rounded-xl font-bold">å¯¼å…¥</button><button @click="showImport = false" class="flex-1 border py-3 rounded-xl">å–æ¶ˆ</button></div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const showCover = ref(true); [cite: 216]
                const enterApp = () => showCover.value = false; [cite: 216]
                const mode = ref('card'); [cite: 220]
                const currentLang = ref('jp'); [cite: 216]
                const wordInput = ref(''); [cite: 216]
                const isFlipped = ref(false); [cite: 217]
                const card = ref({}); [cite: 235]
                const history = ref(JSON.parse(localStorage.getItem('memori_history') || '[]'));
                const gardenPlants = ref(JSON.parse(localStorage.getItem('memori_garden') || '[]'));
                const userCat = ref('./my-cat.png'); [cite: 218, 219]
                const coverImages = { bg: './cover-bg.jpg', cat: './cover-cat.png' }; [cite: 219]
                const historyTab = ref('asia'); [cite: 220]
                const showImport = ref(false);
                const importLang = ref('cjp');
                const dictFile = ref(null);

                const langConfig = {
                    jp: { name: 'æ—¥è¯­', flag: 'ğŸ‡¯ğŸ‡µ', accent: '#CB3A56', bg: '#F9F1F0', voice: 'ja-JP' },
                    cjp: { name: 'å¤å…¸æ—¥è¯­', flag: 'ğŸ¯', accent: '#5A3D30', bg: '#EBE6DF', voice: 'ja-JP' },
                    zh: { name: 'ç°ä»£æ±‰è¯­', flag: 'ğŸ‡¨ğŸ‡³', accent: '#9D2933', bg: '#FBF8F1', voice: 'zh-CN' },
                    lzh: { name: 'å¤ä»£æ±‰è¯­', flag: 'ğŸ“œ', accent: '#41555D', bg: '#E9EAE4', voice: 'zh-CN' },
                    en: { name: 'è‹±è¯­', flag: 'ğŸ‡¬ğŸ‡§', accent: '#1772B4', bg: '#E6E8EB', voice: 'en-US' },
                    de: { name: 'å¾·è¯­', flag: 'ğŸ‡©ğŸ‡ª', accent: '#374E59', bg: '#E8ECEB', voice: 'de-DE' },
                    it: { name: 'æ„è¯­', flag: 'ğŸ‡®ğŸ‡¹', accent: '#8E4932', bg: '#F8F4E8', voice: 'it-IT' },
                    lat: { name: 'æ‹‰ä¸è¯­', flag: 'ğŸ›ï¸', accent: '#605A54', bg: '#EAE8E6', voice: 'it-IT' },
                    kr: { name: 'éŸ©è¯­', flag: 'ğŸ‡°ğŸ‡·', accent: '#B25D7E', bg: '#F7EFF2', voice: 'ko-KR' }
                }; [cite: 230-234]

                const timelines = ref({
                    asia: [
                        { id: 1, year: 'å‰7000', event: 'æ²³å§†æ¸¡æ–‡åŒ– (ç¨»ä½œæ–‡æ˜èµ·æº)', tag: 'ğŸ‡¨ğŸ‡³', tags: ['è€ƒå¤'] }, [cite: 227]
                        { id: 100, year: 'å‰221', event: 'ç§¦å§‹çš‡ç»Ÿä¸€', tag: 'ğŸ§±', tags: ['ç»Ÿä¸€'] }, [cite: 227]
                        { id: 1001, year: 'å‰1600', event: 'å•†æœå»ºç«‹ (é’é“œæ–‡æ˜é¼ç››)', tag: 'ğŸº', tags: ['ç‹æœ'] },
                        { id: 1002, year: 'å‰1046', event: 'ç‰§é‡ä¹‹æˆ˜ (å‘¨æœå¼€å¯)', tag: 'âš”ï¸', tags: ['æˆ˜äº‰'] },
                        { id: 1003, year: 'å‰138', event: 'å¼ éªå‡ºä½¿è¥¿åŸŸ (ä¸ç»¸ä¹‹è·¯)', tag: 'ğŸ«', tags: ['å¤–äº¤'] },
                        { id: 1004, year: '57', event: 'æ±‰å§”å¥´å›½ç‹å° (æœ€æ—©çš„ä¸­æ—¥äº¤å¾€è®°å½•)', tag: 'ğŸ‡¯ğŸ‡µ', tags: ['æ—¥æœ¬'] },
                        { id: 1005, year: '645', event: 'å¤§åŒ–æ”¹æ–° (æ—¥æœ¬å¾‹ä»¤å›½å®¶ä½“åˆ¶)', tag: 'ğŸ“œ', tags: ['æ—¥æœ¬'] },
                        { id: 1006, year: '1405', event: 'éƒ‘å’Œä¸‹è¥¿æ´‹', tag: 'â›µ', tags: ['èˆªæµ·'] },
                        { id: 1007, year: '1443', event: 'è®­æ°‘æ­£éŸ³ (æœé²œè°šæ–‡åˆ›åˆ¶)', tag: 'ğŸ‡°ğŸ‡·', tags: ['éŸ©å›½'] },
                        { id: 1008, year: '1600', event: 'å…³åŸä¹‹æˆ˜ (å¾·å·å¹•åºœç¡®ç«‹)', tag: 'ğŸ¯', tags: ['æ—¥æœ¬'] },
                        { id: 1009, year: '1868', event: 'æ˜æ²»ç»´æ–°', tag: 'âš™ï¸', tags: ['æ—¥æœ¬'] },
                        { id: 1010, year: '1911', event: 'è¾›äº¥é©å‘½ (æ¸…æœç­äº¡)', tag: 'ğŸš©', tags: ['é©å‘½'] }
                    ],
                    europe: [
                        { id: 2001, year: 'å‰3000', event: 'å·¨çŸ³é˜µä¸»ä½“å»ºé€ ', tag: 'ğŸª¨', tags: ['è€ƒå¤'] },
                        { id: 201, year: 'å‰753', event: 'ç½—é©¬å»ºåŸ', tag: 'ğŸ›ï¸', tags: ['ä¼ è¯´'] }, [cite: 227]
                        { id: 2002, year: 'å‰490', event: 'é©¬æ‹‰æ¾æˆ˜å½¹ (å¸Œæ³¢æˆ˜äº‰)', tag: 'ğŸƒ', tags: ['å¸Œè…Š'] },
                        { id: 2003, year: 'å‰27', event: 'å±‹å¤§ç»´ç§°å·å¥¥å¤æ–¯éƒ½ (ç½—é©¬å¸å›½)', tag: 'ğŸ‘‘', tags: ['ç½—é©¬'] },
                        { id: 2004, year: '476', event: 'è¥¿ç½—é©¬å¸å›½ç­äº¡', tag: 'ğŸ“‰', tags: ['ä¸­ä¸–çºª'] },
                        { id: 2005, year: '1066', event: 'é»‘æ–¯å»·æ–¯æˆ˜å½¹ (è¯ºæ›¼å¾æœ)', tag: 'ğŸ›¡ï¸', tags: ['è‹±å›½'] },
                        { id: 2006, year: '1215', event: 'å¤§å®ªç« ç­¾ç½²', tag: 'ğŸ“œ', tags: ['æ³•å¾‹'] },
                        { id: 2007, year: '1453', event: 'å›å£«å¦ä¸å ¡é™·è½ (ä¸œç½—é©¬ç­äº¡)', tag: 'â˜ªï¸', tags: ['æ‹œå åº­'] },
                        { id: 2008, year: '1517', event: 'ä¹åäº”æ¡è®ºçº² (å®—æ•™æ”¹é©)', tag: 'ğŸ”¨', tags: ['å®—æ•™'] },
                        { id: 202, year: '1789', event: 'æ³•å›½å¤§é©å‘½', tag: 'ğŸ‡«ğŸ‡·', tags: ['é©å‘½'] }, [cite: 228]
                        { id: 2009, year: '1815', event: 'æ»‘é“å¢æˆ˜å½¹', tag: 'âš”ï¸', tags: ['æˆ˜äº‰'] },
                        { id: 2010, year: '1914', event: 'è¨æ‹‰çƒ­çªäº‹ä»¶ (ä¸€æˆ˜çˆ†å‘)', tag: 'ğŸ’£', tags: ['æˆ˜äº‰'] }
                    ]
                });

                const filteredHistory = computed(() => history.value.filter(h => h.lang === currentLang.value).reverse());

                const groupedTimelines = computed(() => {
                    const list = timelines.value[historyTab.value];
                    const groups = {};
                    list.forEach(e => {
                        if(!groups[e.year]) groups[e.year] = { year: e.year, events: [] };
                        groups[e.year].events.push(e);
                    });
                    return Object.values(groups);
                });

                async function handleSearch() {
                    if (!wordInput.value) return;
                    const query = wordInput.value;
                    mode.value = 'card';
                    isFlipped.value = false;

                    // 1. æœ¬åœ°ä¼˜å…ˆ (é€»è¾‘é¢„ç•™)
                    const res = await fetch('/api/openai', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ word: query, lang: currentLang.value })
                    });
                    const data = await res.json();
                    card.value = { ...data, id: Date.now(), lang: currentLang.value };
                    history.value.push(card.value);
                    save();
                }

                function save() { 
                    localStorage.setItem('memori_history', JSON.stringify(history.value));
                    localStorage.setItem('memori_garden', JSON.stringify(gardenPlants.value));
                }
                
                function loadWord(item) { card.value = item; isFlipped.value = false; mode.value = 'card'; }
                
                function speak(text) {
                    if (['zh','lzh'].includes(currentLang.value)) return;
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = langConfig[currentLang.value].voice;
                    window.speechSynthesis.speak(u);
                }

                return { showCover, enterApp, mode, currentLang, wordInput, isFlipped, card, history, filteredHistory, langConfig, timelines, historyTab, groupedTimelines, handleSearch, loadWord, speak, userCat, coverImages, gardenPlants, showImport, importLang, dictFile };
            }
        }).mount('#app');
    </script>
</body>
</html>
