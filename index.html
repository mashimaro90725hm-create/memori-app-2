<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memori - è¨€å¶ã®è€ƒå¤å­¦</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
/* --- ğŸ® ä¸­å›½è‰²ä¸»é¢˜å˜é‡ --- */
:root {
  --color-bg-main: #E2E1E4; /* èŠ¡é£Ÿç™½ */
  --color-text-main: #2D241E; /* ä¹Œè‰² */
  --color-accent: #CB3A56; /* èŒœè‰² */
  --color-accent-hover: #EF7A82; /* å«£çº¢ */
  --glass-bg: rgba(255, 253, 248, 0.75); 
  --glass-border: rgba(203, 58, 86, 0.15); 
}

/* ğŸ¨ å…¨å±€å¸ƒå±€ */
* { box-sizing: border-box; }
.app-container { display: flex; width: 100vw; height: 100vh; overflow: hidden; position: relative; color: var(--color-text-main); }
.app-container.with-texture::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; z-index: 0; mix-blend-mode: multiply; }

.glass-morphism { background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 24px; box-shadow: 0 4px 12px rgba(45, 36, 30, 0.08); }

/* ğŸšª å°é¢é¡µ */
.cover-stage.classic-theme { position: fixed; inset: 0; background-size: cover; background-position: center; z-index: 1000; display: flex; justify-content: center; align-items: center; }
.cover-overlay-gradient { position: absolute; inset: 0; background: linear-gradient(to right, rgba(45, 36, 30, 0.6) 0%, rgba(45, 36, 30, 0.2) 60%, transparent 100%); }
.cover-content-layout { position: relative; z-index: 2; width: 90%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; height: 80vh; }
.cover-text-group { flex: 1; color: #f8f4e6; text-align: right; z-index: 50; padding-left: 50px; }
.cover-title-main { font-family: 'Zen Old Mincho', serif; font-size: 5rem; font-weight: 700; color: #fff; }
.start-btn-main { margin-top: 60px; padding: 16px 48px; font-size: 1.2rem; background: var(--color-accent); color: #fff; border-radius: 4px; cursor: pointer; position: relative; z-index: 110; pointer-events: auto; font-family: 'Noto Serif JP', serif; }

/* ğŸ® ä¾§è¾¹æ  */
.sidebar { width: 280px; display: flex; flex-direction: column; padding: 30px 20px; z-index: 20; margin: 20px 0 20px 20px; }
.word-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 18px; margin-bottom: 10px; border-radius: 16px; cursor: pointer; transition: all 0.2s; background: rgba(255, 253, 248, 0.5); }
.word-item.active { background: white; border-left: 4px solid var(--color-accent); box-shadow: 0 4px 12px rgba(45, 36, 30, 0.08); }

/* ğŸ® å¡ç‰‡ç¿»è½¬é€»è¾‘ä¼˜åŒ– (å…¨åŸŸç‚¹å‡») */
.card-3d-wrapper { width: 400px; height: 600px; perspective: 1500px; cursor: pointer; z-index: 2; }
.card-body { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; }
.card-body.is-flipped { transform: rotateY(180deg); }
.card-face { position: absolute; inset: 0; backface-visibility: hidden; display: flex; flex-direction: column; background: #FFFFFF; border-radius: 24px; padding: 40px; border: 1px solid var(--glass-border); }
.card-face.back { transform: rotateY(180deg); overflow-y: auto; }

/* æ’ç‰ˆç»†èŠ‚ */
.main-word { font-size: 3.2rem; font-family: 'Zen Old Mincho', serif; margin-bottom: 10px; }
.divider { height: 1px; background-image: linear-gradient(to right, #D5C9BB 40%, transparent 20%); background-size: 6px 1px; background-repeat: repeat-x; width: 100%; margin: 25px 0; }
.label-tag { font-size: 0.75rem; text-transform: uppercase; color: var(--color-accent); letter-spacing: 1.5px; font-weight: bold; margin-bottom: 8px; display: block; }
.ex-text { font-style: italic; color: #444; border-left: 3px solid var(--glass-border); padding-left: 15px; margin-bottom: 15px; font-family: serif; }
.ex-text span:hover { text-decoration: underline; color: var(--color-accent); cursor: help; } /* è¯æ±‡ç‚¹å‡»æç¤º */

/* å¹´è¡¨ */
.history-stage { width: 95%; height: 90vh; padding: 40px; overflow: hidden; display: flex; flex-direction: column; }
.timeline-wrapper { flex: 1; overflow-y: auto; }
.t-content { background: rgba(255, 253, 248, 0.9); padding: 15px 22px; border: 1px solid var(--glass-border); border-radius: 18px; margin-bottom: 15px; }

.fade-enter-active, .fade-leave-active { transition: opacity 0.5s ease; }
.fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>
    <div id="app">
        <Transition name="fade">
            <div v-if="showCover" class="cover-stage classic-theme" :style="{ backgroundImage: `url(${coverImages.bg})` }">
                <div class="cover-overlay-gradient"></div>
                <div class="cover-content-layout">
                    <div class="flex-shrink-0"><img :src="coverImages.cat" class="max-h-[75vh] drop-shadow-2xl"></div>
                    <div class="cover-text-group">
                        <h1 class="cover-title-main">Memori</h1>
                        <p class="text-2xl font-serif tracking-widest mt-2">è¨€è‘‰ã®è€ƒå¤å­¦</p>
                        <div class="mt-12 text-xl font-serif leading-loose opacity-80">
                            <p>åŸ‹æ²¡äºå†å²å°˜æ²™ä¸­çš„æ–‡å­—ï¼Œ</p>
                            <p>å³æ˜¯å¼€å¯æ–‡æ˜ç¢ç‰‡çš„é’¥åŒ™ã€‚</p>
                        </div>
                        <button class="start-btn-main" @click="enterApp">å¼€å¯å­¦æœ¯æ¢ç´¢</button>
                    </div>
                </div>
            </div>
        </Transition>

        <div v-if="!showCover" class="app-container with-texture" :style="{ background: langConfig[currentLang].bg }">
            
            <aside class="sidebar glass-morphism">
                <div class="sidebar-header border-b border-pink-100 pb-4 mb-4">
                    <h3 class="font-bold flex justify-between items-center">
                        <span>{{ langConfig[currentLang].flag }} {{ langConfig[currentLang].name }}</span>
                        <span class="text-xs opacity-50 font-sans">{{ filteredHistory.length }} è¯</span>
                    </h3>
                </div>
                <div class="word-list flex-1 overflow-y-auto pr-2 custom-scroll">
                    <div v-for="item in filteredHistory" :key="item.id" 
                         class="word-item group" 
                         :class="{ 'active': card.id === item.id }"
                         @click="loadWord(item)">
                        <span class="truncate">{{ item.word }}</span>
                        <button class="opacity-0 group-hover:opacity-100 text-red-400 font-bold" @click.stop="deleteWord(item.id)">Ã—</button>
                    </div>
                </div>
                <div class="sidebar-footer mt-4 pt-4 border-t border-pink-100 flex flex-col gap-3 relative">
                    <div class="shiba-mascot" @click="pokeMascot">
                        <img :src="shibaImages[neroState]" class="w-full">
                    </div>
                    <button class="artistic-btn bg-[#CB3A56] text-white py-3 rounded-xl font-bold" @click="startReview">å¤ä¹ è®¡åˆ’</button>
                    <button class="artistic-btn border border-pink-200 py-3 rounded-xl" @click="mode = 'history'">å†å²å¹´è¡¨</button>
                </div>
            </aside>

            <main class="main-stage">
                <div class="search-bar glass-morphism w-full max-w-[600px] flex items-center px-6 py-3 mb-8">
                    <div class="flex gap-2 mr-4">
                        <button v-for="(cfg, key) in langConfig" @click="switchLang(key)" 
                                class="w-9 h-9 rounded-xl flex items-center justify-center transition-all"
                                :class="currentLang === key ? 'bg-white border-2 border-[#CB3A56]' : 'opacity-40'">
                            {{ cfg.flag }}
                        </button>
                    </div>
                    <input v-model="wordInput" @keyup.enter="generateCard" :placeholder="`æ£€ç´¢${langConfig[currentLang].name}å­¦æœ¯è¯æ±‡...`" class="bg-transparent outline-none flex-1 text-xl">
                    <button @click="generateCard" class="text-2xl text-[#CB3A56]"><i v-if="loading" class="fa-solid fa-spinner fa-spin"></i><i v-else class="fa-solid fa-magnifying-glass"></i></button>
                </div>

                <Transition name="fade-mode" mode="out-in">
                    <div v-if="mode === 'card'" class="card-3d-wrapper" @click="isFlipped = !isFlipped">
                        <div class="card-body" :class="{ 'is-flipped': isFlipped }">
                            <div class="card-face glass-morphism text-center">
                                <div class="text-[#CB3A56] font-sans text-sm tracking-widest mb-2">{{ card.reading }}</div>
                                <h2 class="main-word">{{ card.word }}</h2>
                                <div class="divider"></div>
                                <div class="flex-1 flex flex-col justify-center">
                                    <span class="label-tag">å­¦æœ¯é‡Šä¹‰</span>
                                    <div class="text-xl leading-relaxed" v-html="card.meaning"></div>
                                </div>
                                <div class="mt-8 text-xs opacity-30 italic">ç‚¹å‡»å¡ç‰‡ä»»æ„ä½ç½®æŸ¥çœ‹è¯¦å°½è€ƒè¯</div>
                            </div>
                            <div class="card-face back glass-morphism" @click.stop>
                                <div class="mb-6">
                                    <span class="label-tag">è¯­æºè€ƒè¯ / Etymology</span>
                                    <div class="text-base leading-relaxed text-justify" v-html="card.etymology"></div>
                                </div>
                                <div v-if="card.examples && card.examples.length">
                                    <span class="label-tag">æ–‡çŒ®ä¾‹è¯ / Examples</span>
                                    <div v-for="ex in card.examples" class="ex-row mb-6">
                                        <p class="ex-text" @click="speak(ex.text)">
                                            <span v-for="word in ex.text.split(' ')" @click.stop="searchThis(word)" class="hover:text-[#CB3A56] cursor-help">{{word}} </span>
                                        </p>
                                        <p class="text-sm text-gray-500">{{ ex.cn }}</p>
                                    </div>
                                </div>
                                <button class="mt-auto w-full bg-[#CB3A56] text-white py-3 rounded-xl font-bold" @click="toggleCollect">
                                    {{ card.isCollected ? 'âœ” å·²å½’æ¡£' : 'â• å­˜å…¥å•è¯æœ¬' }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div v-else-if="mode === 'review' && reviewCard" class="flex gap-10 items-start">
                        </div>

                    </Transition>
            </main>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                const showCover = ref(true);
                const currentLang = ref('jp');
                const wordInput = ref('');
                const loading = ref(false);
                const isFlipped = ref(false);
                const history = ref([]);
                const mode = ref('card');
                const neroState = ref('idle');

                const coverImages = { bg: './cover-bg.jpg', cat: './cover-cat.png' };
                const shibaImages = { idle: './shiba/idle.gif', thinking: './shiba/run.gif', happy: './shiba/happy.gif' };

                const card = ref({ word: 'è¨€å¶è€ƒå¤', reading: 'Kotoba Archaeology', meaning: 'å­¦æœ¯æ£€ç´¢ç³»ç»Ÿå°±ç»ª', etymology: 'æš‚æ— æ•°æ®', examples: [] });

                const langConfig = {
                    jp: { name: 'æ—¥è¯­', flag: 'ğŸ‡¯ğŸ‡µ', voice: 'ja-JP', bg: 'linear-gradient(to top, #F9F1F0, #FCEFE8)', accent: '#CB3A56' },
                    zh: { name: 'æ±‰è¯­', flag: 'ğŸ‡¨ğŸ‡³', voice: 'zh-CN', bg: 'linear-gradient(120deg, #FBF8F1, #F6F4EF)', accent: '#9D2933' },
                    lzh: { name: 'å¤ä»£æ±‰è¯­', flag: 'ğŸ“œ', voice: 'zh-CN', bg: '#F4F5F0', accent: '#41555D' },
                    en: { name: 'è‹±è¯­', flag: 'ğŸ‡¬ğŸ‡§', voice: 'en-US', bg: '#EDF1F4', accent: '#1772B4' },
                    kr: { name: 'éŸ©è¯­', flag: 'ğŸ‡°ğŸ‡·', voice: 'ko-KR', bg: '#F9EDF1', accent: '#B25D7E' },
                    lat: { name: 'æ‹‰ä¸è¯­', flag: 'ğŸ›ï¸', voice: 'it-IT', bg: '#EAE8E6', accent: '#605A54' }
                };

                const filteredHistory = computed(() => history.value.filter(h => h.lang === currentLang.value));

                async function generateCard() {
                    if(!wordInput.value) return;
                    loading.value = true; neroState.value = 'thinking'; isFlipped.value = false;
                    try {
                        const res = await fetch('/api/openai', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ word: wordInput.value, lang: currentLang.value })
                        });
                        const data = await res.json();
                        card.value = { ...data, lang: currentLang.value, isCollected: false };
                        speak(card.value.word);
                        neroState.value = 'happy'; setTimeout(()=>neroState.value='idle', 2000);
                        wordInput.value = '';
                    } catch(e) { alert("æ£€ç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚"); } finally { loading.value = false; }
                }

                function searchThis(w) { wordInput.value = w.replace(/[.,!?;:()]/g, ""); generateCard(); }

                function speak(t) {
                    window.speechSynthesis.cancel();
                    const ut = new SpeechSynthesisUtterance(t);
                    ut.lang = langConfig[currentLang.value].voice;
                    ut.rate = 0.85; // ç¨æ…¢çš„é€Ÿåº¦ï¼Œç¡®ä¿å‘éŸ³æ¸…æ™°
                    window.speechSynthesis.speak(ut);
                }

                // ä¾§è¾¹æ åŠåŸºç¡€é€»è¾‘...
                return { 
                    showCover, enterApp:()=>showCover.value=false, currentLang, wordInput, loading, isFlipped, history, card, langConfig, coverImages, shibaImages, neroState, filteredHistory,
                    generateCard, searchThis, speak, loadWord:(item)=>{card.value=item; mode.value='card'}, switchLang:(l)=>{currentLang.value=l; mode.value='card'}
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
