<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memori - Ë®ÄÂè∂„ÅÆËÄÉÂè§Â≠¶ (ÊºîÁ§∫Áâà)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+KR:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
/* --- üèÆ ‰∏≠ÂõΩËâ≤‰∏ªÈ¢òÂèòÈáè (Zhongguose Palette) --- */
:root {
  --color-bg-main: #E2E1E4;
  --color-text-main: #2D241E; 
  --color-accent: #CB3A56;
  --color-accent-hover: #EF7A82; 
  --glass-bg: rgba(255, 253, 248, 0.75);
  --glass-border: rgba(203, 58, 86, 0.15); 
}

* { box-sizing: border-box; }
.app-container { display: flex; width: 100vw; height: 100vh; overflow: hidden; transition: background 0.5s ease, font-family 0.3s; position: relative; color: var(--color-text-main); }
.app-container.with-texture::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; z-index: 0; mix-blend-mode: multiply; }
.glass-morphism { background: var(--glass-bg); backdrop-filter: blur(20px) saturate(110%); border: 1px solid var(--glass-border); box-shadow: 0 4px 12px -1px rgba(45, 36, 30, 0.08), 0 2px 4px -1px rgba(45, 36, 30, 0.04), inset 0 0 20px rgba(255, 253, 248, 0.3); border-radius: 24px; }
.artistic-border { border-radius: 24px; }

/* Â∞ÅÈù¢È°µ */
.cover-stage.classic-theme { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-size: cover; background-position: center; display: flex; justify-content: center; align-items: center; z-index: 1000; overflow: hidden; }
.cover-overlay-gradient { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to right, rgba(45, 36, 30, 0.6) 0%, rgba(45, 36, 30, 0.2) 60%, transparent 100%); }
.cover-content-layout { position: relative; z-index: 2; width: 90%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; height: 80vh; }
.cover-text-group.jp-style { flex: 1; color: #f8f4e6; text-shadow: 0 2px 10px rgba(0,0,0,0.6); padding-left: 50px; text-align: right; z-index: 50; }
.cover-title-main { font-family: 'Zen Old Mincho', serif; font-size: 5rem; font-weight: 700; margin: 0; letter-spacing: 0.05em; color: #fff; }
.subtitle-main { font-family: 'Noto Serif JP', serif; font-size: 1.5rem; font-weight: 500; letter-spacing: 0.3em; margin-top: 15px; opacity: 0.95; color: var(--color-bg-main); }
.poem-main { font-family: 'Zen Old Mincho', serif; font-size: 1.3rem; line-height: 2; margin-top: 50px; opacity: 0.9; }
.start-btn-main.jp-btn { margin-top: 60px; font-family: 'Noto Serif JP', serif; padding: 16px 48px; font-size: 1.2rem; font-weight: 700; background: linear-gradient(135deg, var(--color-accent) 0%, #A62C45 100%); color: #fff; border: none; border-radius: 4px; cursor: pointer; transition: all 0.4s; letter-spacing: 0.1em; box-shadow: 0 4px 20px rgba(203, 58, 86, 0.4); pointer-events: auto; position: relative; z-index: 100;}
.start-btn-main.jp-btn:hover { transform: translateY(-3px) scale(1.02); background: linear-gradient(135deg, var(--color-accent-hover) 0%, var(--color-accent) 100%); box-shadow: 0 8px 30px rgba(203, 58, 86, 0.5); }
.cover-cat-wrapper { flex: 0 0 40%; height: 100%; display: flex; justify-content: flex-start; align-items: flex-end; z-index: 1; pointer-events: none; }
.cover-cat-large { max-width: 100%; max-height: 75vh; object-fit: contain; filter: drop-shadow(0 10px 30px rgba(60, 40, 30, 0.6)); transform: translateX(-10%) scaleX(-1); }
.fade-enter-active, .fade-leave-active { transition: opacity 1s ease; }
.fade-enter-from, .fade-leave-to { opacity: 0; }

/* Sidebar */
.sidebar { width: 280px; display: flex; flex-direction: column; padding: 30px 20px; z-index: 20; margin: 20px 0 20px 20px; }
.sidebar-header { padding: 0 10px 16px; border-bottom: 1px solid var(--glass-border); }
.sidebar-header h3 { font-size: 1.2rem; font-weight: bold; margin: 0; display: flex; justify-content: space-between; font-family: inherit; }
.count { font-size: 0.8rem; opacity: 0.7; font-family: sans-serif; }
.word-list { flex: 1; overflow-y: auto; padding: 15px 0; }
.custom-scroll::-webkit-scrollbar { width: 6px; }
.custom-scroll::-webkit-scrollbar-track { background: rgba(45, 36, 30, 0.05); border-radius: 3px; }
.custom-scroll::-webkit-scrollbar-thumb { background: rgba(45, 36, 30, 0.2); border-radius: 3px; }
.word-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 18px; margin-bottom: 10px; border-radius: 16px; cursor: pointer; transition: all 0.2s; color: var(--color-text-main); border-left: 4px solid transparent; position: relative; background: rgba(255, 253, 248, 0.5); }
.word-item:hover { background: rgba(255, 253, 248, 0.85); transform: translateX(2px); }
.word-item.active { background: white; box-shadow: 0 4px 12px rgba(45, 36, 30, 0.08); font-weight: bold; color: var(--color-text-main); }
.item-actions { display: flex; gap: 5px; opacity: 0; transition: opacity 0.2s; position: absolute; right: 12px; z-index: 20; background: var(--glass-bg); border-radius: 8px; padding: 3px; box-shadow: 0 2px 8px rgba(45, 36, 30, 0.1); }
.word-item:hover .item-actions { opacity: 1; }
.del-icon { opacity: 0.8; border: none; background: none; color: var(--color-accent); cursor: pointer; font-weight: bold; padding: 4px 8px; font-size: 1.1rem; transition: opacity 0.2s; }
.del-icon:hover { opacity: 1; }
.sidebar-footer { padding-top: 25px; display: flex; flex-direction: column; gap: 12px; position: relative; border-top: 1px solid var(--glass-border); }
.action-btn.artistic-btn { width: 100%; padding: 14px; border: none; border-radius: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-family: inherit; transition: all 0.2s; letter-spacing: 0.5px; }
.action-btn.primary { color: white; box-shadow: 0 4px 12px rgba(203, 58, 86, 0.25); }
.action-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(203, 58, 86, 0.35); background-color: var(--color-accent-hover) !important; }
.action-btn.outline { background: rgba(255, 253, 248, 0.6); color: var(--color-text-main); border: 1px solid var(--glass-border); }
.action-btn.outline:hover { background: white; border-color: var(--color-accent); transform: translateY(-2px); color: var(--color-accent); }

/* Mascots */
.shiba-mascot { position: absolute; bottom: 100%; right: 0px; width: 135px; height: 135px; cursor: pointer; z-index: 20; transition: transform 0.2s; margin-bottom: 15px; }
.shiba-mascot:hover { transform: scale(1.05) rotate(3deg); }
.shiba-img { width: 100%; height: 100%; object-fit: contain; drop-shadow: 0 5px 15px rgba(45, 36, 30, 0.15); }
.shiba-bubble { position: absolute; top: -35px; left: 50%; transform: translateX(-50%); background: white; padding: 6px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; white-space: nowrap; box-shadow: 0 4px 10px rgba(45, 36, 30, 0.1); animation: popIn 0.3s; color: var(--color-text-main); }
.shiba-bubble::after { content: ''; position: absolute; bottom: -6px; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: white transparent transparent transparent; }
.cat-mascot-container { position: fixed; bottom: 30px; right: 30px; width: 280px; height: 280px; cursor: pointer; z-index: 100; transition: transform 0.3s ease; }
.cat-mascot-container:hover { transform: scale(1.03); }
.cat-img-wrapper { width: 100%; height: 100%; transform: scaleX(-1); filter: drop-shadow(0 10px 25px rgba(45, 36, 30, 0.3)); }
.cat-mascot-img { width: 100%; height: 100%; object-fit: contain; }
.idle-anim { animation: float 3.5s ease-in-out infinite; }
.thinking-anim { animation: tilt 0.6s ease-in-out infinite alternate; }
.cat-mascot-container.poked .cat-mascot-img { animation: jump 0.5s cubic-bezier(0.28, 0.84, 0.42, 1); }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
@keyframes tilt { 0% { transform: rotate(-6deg); } 100% { transform: rotate(6deg); } }
@keyframes jump { 0% { transform: scale(1,1) translateY(0); } 30% { transform: scale(0.92,1.08) translateY(-50px); } 100% { transform: scale(1,1) translateY(0); } }
.cat-bubble { position: absolute; top: -45px; left: 50%; transform: translateX(-50%); background: white; padding: 10px 20px; border-radius: 20px; font-size: 1.1rem; font-weight: bold; white-space: nowrap; box-shadow: 0 5px 15px rgba(45, 36, 30, 0.15); animation: popIn 0.3s; color: var(--color-text-main); }
.cat-bubble::after { content: ''; position: absolute; bottom: -8px; left: 50%; margin-left: -8px; border-width: 8px; border-style: solid; border-color: white transparent transparent transparent; }
@keyframes popIn { from { opacity: 0; transform: translateX(-50%) scale(0.5) translateY(20px); } to { opacity: 1; transform: translateX(-50%) scale(1) translateY(0); } }

/* Main Stage & Transitions */
.main-stage { flex: 1; position: relative; display: flex; flex-direction: column; padding: 20px; z-index: 10; }
.search-bar { margin: 0 20px 25px; padding: 12px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 50; }
.lang-pills { display: flex; gap: 10px; }
.lang-pill { width: 36px; height: 36px; border-radius: 12px; border: 1px solid transparent; background: rgba(255, 253, 248, 0.5); cursor: pointer; font-size: 18px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; color: var(--color-text-main); }
.lang-pill.active { background: white; transform: scale(1.1); box-shadow: 0 4px 10px rgba(45, 36, 30, 0.1); border-color: var(--glass-border); }
.search-input { border: none; background: transparent; padding: 10px; flex: 1; margin: 0 25px; outline: none; font-size: 1.2rem; font-family: inherit; color: var(--color-text-main); }
.search-input::placeholder { color: rgba(45, 36, 30, 0.5); }
.search-btn { border: none; background: transparent; cursor: pointer; font-size: 1.3rem; transition: transform 0.2s; }
.search-btn:hover { transform: scale(1.1); color: var(--color-accent-hover) !important; }
.fade-mode-enter-active, .fade-mode-leave-active { transition: opacity 0.3s ease, transform 0.3s ease; }
.fade-mode-enter-from { opacity: 0; transform: translateY(10px); }
.fade-mode-leave-to { opacity: 0; transform: translateY(-10px); }

/* Gallery Mode */
.gallery-mode { display: flex; flex-direction: column; overflow-y: auto; padding: 25px 50px; }
.gallery-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid var(--glass-border); padding-bottom: 15px; }
.gallery-title { font-size: 1.8rem; font-weight: bold; margin: 0; }
.clear-history-icon { border: none; background: none; color: #aaa; cursor: pointer; font-size: 1.2rem; transition: color 0.3s; padding: 5px; }
.clear-history-icon:hover { color: var(--color-accent); }
.gallery-list { display: flex; flex-direction: column; gap: 16px; padding-bottom: 50px; }
.gallery-row-item { display: flex; justify-content: space-between; align-items: center; padding: 18px 25px; border-radius: 16px; cursor: pointer; transition: all 0.3s; background: rgba(255, 253, 248, 0.6); border: 1px solid var(--glass-border); position: relative; overflow: hidden; }
.gallery-row-item::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: rgba(203, 58, 86, 0.2); transition: width 0.3s; }
.gallery-row-item:hover { transform: translateX(5px); background: rgba(255, 253, 248, 0.9); box-shadow: 0 5px 15px rgba(45, 36, 30, 0.06); }
.gallery-row-item:hover::before { width: 10px; background: var(--color-accent); }
.row-left { display: flex; flex-direction: column; }
.row-word { font-size: 1.4rem; font-weight: bold; color: var(--color-text-main); font-family: 'Zen Old Mincho', serif; }
.row-reading { font-size: 0.9rem; color: rgba(45, 36, 30, 0.7); margin-top: 4px; font-family: sans-serif; }
.row-right { font-size: 1.2rem; color: #ccc; transition: transform 0.3s; display: flex; align-items: center; gap: 15px; }
.gallery-row-item:hover .row-right { transform: translateX(5px); color: var(--color-text-main); }
.row-del-btn { opacity: 0; border: none; background: none; color: var(--color-accent); cursor: pointer; transition: opacity 0.3s; font-size: 1rem; }
.gallery-row-item:hover .row-del-btn { opacity: 1; }
.empty-state { text-align: center; color: rgba(45, 36, 30, 0.5); font-size: 1.2rem; margin-top: 50px; }
.flower-field-container { margin-bottom: 30px; background: rgba(255, 253, 248, 0.4); padding: 20px; border-radius: 20px; border: 1px solid var(--glass-border); }
.field-label { font-size: 0.9rem; color: rgba(45, 36, 30, 0.7); margin-bottom: 15px; letter-spacing: 1px; }
.flower-grid { display: flex; gap: 15px; flex-wrap: wrap; }
.flower-item { width: 60px; height: 60px; background: white; border-radius: 50%; padding: 5px; box-shadow: 0 4px 10px rgba(45, 36, 30, 0.1); transition: transform 0.3s; border: 1px solid var(--glass-border); }
.flower-item:hover { transform: scale(1.1); }
.flower-img { width: 100%; height: 100%; object-fit: contain; border-radius: 50%; }

/* Card 3D */
.card-3d-wrapper { width: 400px; height: 600px; perspective: 1500px; cursor: pointer; z-index: 2; }
.card-body { position: relative; width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; }
.card-body.is-flipped { transform: rotateY(180deg); }
.card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; overflow: hidden; display: flex; flex-direction: column; background: #F3F2F0; border-radius: 24px; }
.img-header { height: 55%; width: 100%; position: relative; background: #E2E1E4; border-bottom: 1px solid var(--glass-border); flex-shrink: 0; }
.img-header.loading { animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { background-color: #E2E1E4; } 50% { background-color: #D6D5D8; } 100% { background-color: #E2E1E4; } }
.cover-img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; mix-blend-mode: multiply; }
.img-loading-spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(45, 36, 30, 0.4); font-size: 2.5rem; }
.overlay-actions { position: absolute; top: 15px; right: 15px; z-index: 10; display: flex; gap: 10px; }
.icon-btn { width: 40px; height: 40px; border-radius: 50%; background: rgba(255, 253, 248, 0.85); border: 1px solid var(--glass-border); cursor: pointer; backdrop-filter: blur(6px); transition: transform 0.2s, background 0.2s; color: var(--color-text-main); display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(45, 36, 30, 0.1); }
.icon-btn:hover { transform: scale(1.08); background: white; color: var(--color-accent); }
.star-btn i.starred { color: var(--color-accent); text-shadow: 0 0 5px rgba(203, 58, 86, 0.3); }
.text-content { flex: 1; padding: 20px 30px; display: flex; flex-direction: column; align-items: center; justify-content: space-around; background: rgba(255, 253, 248, 0.5); overflow-y: auto; }
.word-group { position: relative; display: inline-block; margin-bottom: 8px; }
.main-word { font-size: 3.2rem; margin: 10px 0; line-height: 1.2; text-align: center; position: relative; z-index: 2; letter-spacing: -0.03em; color: var(--color-text-main); font-family: 'Zen Old Mincho', serif; }
.pronunciation { display: flex; align-items: center; gap: 12px; color: rgba(45, 36, 30, 0.7); font-size: 1.15rem; margin-bottom: 15px; }
.simple-en { font-style: italic; color: rgba(45, 36, 30, 0.6); font-size: 0.95rem; margin-top: 12px; font-family: serif; text-align: center; }
.flip-hint { margin-top: auto; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1.2px; color: rgba(45, 36, 30, 0.5); display: flex; align-items: center; gap: 6px; font-weight: 500; }
.speaker-btn { width: 34px; height: 34px; border-radius: 50%; background: rgba(45, 36, 30, 0.08); border: none; cursor: pointer; color: var(--color-text-main); display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
.speaker-btn:hover { background: var(--color-accent); color: white; }
.meta-info { margin-top: 18px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
.meta-tag { font-size: 0.85rem; background: rgba(45, 36, 30, 0.06); padding: 5px 12px; border-radius: 10px; color: rgba(45, 36, 30, 0.8); font-weight: 500; }
.card-face.back { transform: rotateY(180deg); background: rgba(255, 253, 248, 0.9); }
.back-header { padding: 22px 30px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; background: rgba(255, 253, 248, 0.6); }
.back-header h3 { margin: 0; font-size: 1.6rem; color: var(--color-text-main); font-family: 'Zen Old Mincho', serif; }
.back-actions { display: flex; gap: 12px; }
.back-scroll { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 25px; }
.info-block .label { display: block; font-size: 0.8rem; text-transform: uppercase; color: rgba(45, 36, 30, 0.6); letter-spacing: 1.2px; margin-bottom: 8px; font-weight: 600; }
.info-block p { font-size: 1.1rem; line-height: 1.7; color: var(--color-text-main); margin: 0; text-align: justify; font-family: sans-serif; }
.example-row { margin-bottom: 15px; border-left: 3px solid rgba(203, 58, 86, 0.3); padding-left: 12px; }
.ex-text { font-size: 1.05rem; color: var(--color-text-main); font-style: italic; margin-bottom: 5px; cursor: pointer; transition: color 0.2s; font-family: serif; }
.ex-text:hover { color: var(--color-accent); }
.ex-cn { font-size: 0.9rem; color: rgba(45, 36, 30, 0.7); }
.html-content { font-size: 1.05rem; line-height: 1.7; color: var(--color-text-main); text-align: left; }
.html-content img { max-width: 100%; border-radius: 10px; margin: 12px 0; box-shadow: 0 4px 10px rgba(45, 36, 30, 0.08); }
.html-content b { font-weight: 700; color: var(--color-accent); }

/* Review & Orchard */
.review-with-tree { display: flex; gap: 30px; justify-content: center; padding: 0 40px; }
.review-center { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.review-card { width: 400px; height: 600px; background: rgba(255, 253, 248, 0.95) !important; box-shadow: 0 10px 40px rgba(45, 36, 30, 0.15); border: 1px solid var(--glass-border); display: flex; flex-direction: column; overflow: hidden; border-radius: 24px; }
.review-upper { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; position: relative; z-index: 2; }
.review-img-holder { width: 140px; height: 140px; border-radius: 50%; overflow: hidden; margin-bottom: 25px; border: 5px solid #F3F2F0; box-shadow: 0 10px 25px rgba(45, 36, 30, 0.15); background: #E2E1E4; }
.review-lower { background: rgba(255, 253, 248, 0.6); border-top: 1px solid var(--glass-border); height: 220px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 25px; position: relative; z-index: 2; }
.reveal-btn { background: var(--color-text-main); color: #F3F2F0; border: none; padding: 14px 36px; border-radius: 28px; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; font-size: 1.1rem; }
.reveal-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(45, 36, 30, 0.2); background: var(--color-accent); }
.r-answer { width: 100%; text-align: center; animation: fadeIn 0.4s ease; }
.orchard-sidebar { width: 280px; padding: 25px; display: flex; flex-direction: column; align-items: center; border-radius: 24px; background: var(--glass-bg); height: 640px; justify-content: space-between; }
.orchard-sidebar h3 { font-size: 1.2rem; color: var(--color-text-main); margin-bottom: 10px; }
.tree-display { flex: 1; width: 100%; display: flex; align-items: center; justify-content: center; }
.tree-img { width: 100%; max-height: 300px; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(45, 36, 30, 0.2)); transition: all 0.5s; }
.tree-stats { text-align: center; background: rgba(255, 253, 248, 0.7); padding: 15px; border-radius: 12px; width: 100%; border: 1px solid var(--glass-border); }
.tree-status { font-weight: bold; color: #2E7D32; margin-top: 5px; }
.exit-btn { margin-top: 25px; border: none; background: none; color: rgba(45, 36, 30, 0.6); text-decoration: underline; cursor: pointer; font-size: 1rem; }
.srs-actions { display: flex; gap: 12px; width: 100%; }
.srs-btn { flex: 1; padding: 14px 0; border: none; border-radius: 14px; font-weight: bold; cursor: pointer; color: white; font-size: 1.1rem; transition: transform 0.2s, box-shadow 0.2s, background 0.2s; }
.again { background: #CB3A56; } .hard { background: #F28E16; } .good { background: #8FAB1D; } .easy { background: #2C9678; }

/* Timeline List */
.history-stage { flex: 1; margin: 0 20px 20px; padding: 35px; display: flex; flex-direction: column; overflow: hidden; }
.history-top { flex-shrink: 0; border-bottom: 1px solid var(--glass-border); padding-bottom: 25px; margin-bottom: 25px; }
.history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.history-header h1 { font-size: 2rem; margin: 0; font-family: 'Zen Old Mincho', serif; }
.close-mode-btn { background: none; border: none; font-size: 1.6rem; color: #aaa; cursor: pointer; transition: color 0.2s; }
.history-tabs { display: flex; gap: 25px; margin-bottom: 25px; align-items: center; }
.history-tabs button { background: none; border: none; font-size: 1.15rem; cursor: pointer; opacity: 0.6; padding-bottom: 6px; border-bottom: 3px solid transparent; font-family: inherit; transition: all 0.3s; font-weight: 500; color: var(--color-text-main); }
.history-tabs button.active { opacity: 1; border-bottom-color: currentColor; font-weight: bold; }
.timeline-input-group { background: rgba(255, 253, 248, 0.6); padding: 18px; border-radius: 18px; transition: all 0.3s; border: 1px solid var(--glass-border); }
.timeline-input-group.editing { background: #FFF3E0; border: 1px solid #FFB74D; }
.input-header { font-size: 0.85rem; font-weight: bold; margin-bottom: 12px; color: rgba(45, 36, 30, 0.7); text-transform: uppercase; letter-spacing: 1.2px; display: flex; justify-content: space-between; align-items: center; }
.input-row { display: flex; gap: 12px; }
.t-input { border: 1px solid var(--glass-border); padding: 10px 14px; border-radius: 10px; background: rgba(255, 253, 248, 0.8); outline: none; font-family: inherit; font-size: 1rem; transition: border-color 0.2s; color: var(--color-text-main); }
.t-input.year { width: 110px; } .t-input.tag { width: 70px; text-align: center; } .t-input.event { flex: 1; }
.t-btn { border: none; color: white; padding: 0 24px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: transform 0.2s, box-shadow 0.2s; }
.timeline-wrapper { flex: 1; overflow-y: auto; padding-right: 20px; scroll-padding-top: 20px; }
.timeline-list { position: relative; padding-left: 15px; padding-top: 10px; }
.timeline-spine { position: absolute; left: 95px; top: 0; bottom: 0; width: 3px; background: currentColor; z-index: 0; border-radius: 1.5px; opacity: 0.4; }
.year-group { display: flex; align-items: flex-start; margin-bottom: 40px; position: relative; }
.t-year-label { width: 95px; text-align: right; padding-right: 30px; flex-shrink: 0; position: sticky; top: 0; align-self: flex-start; padding-top: 8px; }
.year-number { font-weight: 800; font-size: 1.2rem; color: var(--color-text-main); background: rgba(255, 253, 248, 0.95); padding: 4px 8px; border-radius: 6px; box-shadow: 0 2px 6px rgba(45, 36, 30, 0.06); font-family: sans-serif; border: 1px solid var(--glass-border); }
.events-container { flex: 1; display: flex; flex-direction: column; gap: 18px; }
.t-item-box { display: flex; align-items: center; position: relative; transition: all 0.3s; cursor: grab; }
.t-dot { width: 16px; height: 16px; border-radius: 50%; position: absolute; left: -26px; top: 22px; border: 4px solid #F3F2F0; box-shadow: 0 2px 6px rgba(45, 36, 30, 0.15); z-index: 2; }
.t-content { flex: 1; background: rgba(255, 253, 248, 0.9); padding: 15px 22px; transition: transform 0.2s, box-shadow 0.2s; position: relative; border: 1px solid var(--glass-border); }
.t-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
.t-icon { font-size: 1.4rem; }
.t-text { flex: 1; font-size: 1.1rem; color: var(--color-text-main); line-height: 1.6; font-weight: 500; font-family: 'Noto Serif SC', sans-serif; }
.t-actions { display: flex; gap: 6px; opacity: 0; transition: opacity 0.2s; background: var(--glass-bg); padding: 4px; border-radius: 8px; position: absolute; right: 12px; top: 12px; box-shadow: 0 2px 8px rgba(45, 36, 30, 0.1); border: 1px solid var(--glass-border); }
.t-content:hover .t-actions { opacity: 1; }
.t-act-btn { border: none; background: none; cursor: pointer; color: rgba(45, 36, 30, 0.4); padding: 5px 7px; font-size: 1rem; transition: color 0.2s; }

@media (max-width: 768px) {
  .app-container { flex-direction: column-reverse; height: auto; overflow-y: auto; }
  .sidebar { width: auto; height: auto; border-right: none; border-top: 1px solid var(--glass-border); margin: 0; padding: 25px; border-radius: 24px 24px 0 0; }
  .main-stage { height: 100vh; padding: 15px; }
}
    </style>
</head>
<body>
    <div id="app">
        <Transition name="fade">
            <div v-if="showCover" class="cover-stage classic-theme" :style="{ backgroundImage: `url(${coverImages.bg})` }">
                <div class="cover-overlay-gradient"></div>
                <div class="cover-content-layout">
                    <div class="cover-cat-wrapper"><img :src="coverImages.cat" class="cover-cat-large" alt="Cover Cat"></div>
                    <div class="cover-text-group jp-style">
                        <h1 class="cover-title-main">Memori</h1>
                        <p class="subtitle-main">Ë®ÄËëâ„ÅÆËÄÉÂè§Â≠¶</p>
                        <div class="poem-main"><p>ÊôÇ„ÅÆÁ†Ç„Å´Âüã„ÇÇ„Çå„Åü„ÄÅ</p><p>Ë®ÄËëâ„ÅÆÊ¨†Áâá„ÇíÊé¢„Åó„Å¶„ÄÇ</p></div>
                        <button class="start-btn-main jp-btn" @click="enterApp">Êé¢Á¥¢„ÇíÂßã„ÇÅ„Çã</button>
                    </div>
                </div>
            </div>
        </Transition>

        <div v-if="!showCover" class="app-container with-texture" :style="{ background: langConfig[currentLang].bg, fontFamily: langConfig[currentLang].font }">
            <aside class="sidebar glass-morphism artistic-border">
                <div class="sidebar-header">
                    <h3 :style="{ color: langConfig[currentLang].accent }">
                        {{ langConfig[currentLang].flag }} {{ langConfig[currentLang].name }} 
                        <span class="count">{{ filteredHistory.length }} ËØç</span>
                    </h3>
                </div>
                <div class="word-list custom-scroll">
                    <div v-for="item in filteredHistory" :key="item.id" 
                         class="word-item" 
                         :class="{ 'active': mode === 'card' && item.id === card.id }"
                         :style="(mode === 'card' && item.id === card.id) ? { borderLeftColor: langConfig[currentLang].accent } : {}"
                         @click="loadWord(item)">
                        <span class="word-text">{{ item.word }}</span>
                        <div class="item-actions"><button class="del-icon" @click.stop="deleteWord(item.id)">√ó</button></div>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <div class="shiba-mascot" @click="pokeMascot">
                        <img :src="shibaImages[neroState]" class="shiba-img" alt="Shiba">
                        <div v-if="neroState === 'thinking'" class="shiba-bubble">ÂóÖÂóÖ...</div>
                        <div v-if="neroState === 'happy'" class="shiba-bubble">È¶ôÔºÅ</div>
                    </div>
                    <button class="action-btn primary artistic-btn" @click="startReview" :style="{ backgroundColor: langConfig[currentLang].accent }"><i class="fa-solid fa-layer-group"></i> Â§ç‰π†</button>
                    <button class="action-btn outline artistic-btn" @click="mode = 'gallery'"><i class="fa-solid fa-images"></i> ËóèÂìÅÈ¶Ü</button>
                    <button class="action-btn outline artistic-btn" @click="mode = 'history'"><i class="fa-solid fa-scroll"></i> ÂéÜÂè≤Âπ¥Ë°®</button>
                </div>
            </aside>

            <main class="main-stage">
                <div class="search-bar glass-morphism artistic-border">
                    <div class="lang-pills">
                        <button v-for="(cfg, key) in langConfig" :key="key" @click="switchLang(key)" class="lang-pill" :class="{ 'active': currentLang === key }" :title="cfg.scent">{{ cfg.flag }}</button>
                    </div>
                    <input v-model="wordInput" @keyup.enter="generateCard" :placeholder="`ÂØªÊâæ${langConfig[currentLang].name}ÁöÑÂë≥ÈÅì...`" class="search-input">
                    <button @click="generateCard" class="search-btn" :disabled="loading" :style="{ color: langConfig[currentLang].accent }"><i v-if="loading" class="fa-solid fa-spinner fa-spin"></i><i v-else class="fa-solid fa-magnifying-glass"></i></button>
                </div>

                <Transition name="fade-mode" mode="out-in">
                    <div v-if="mode === 'gallery'" class="content-area gallery-mode custom-scroll" key="gallery">
                        <div class="gallery-header"><h2 class="gallery-title" :style="{ color: langConfig[currentLang].accent }">È¶ôÊ∞õËóèÂìÅÈ¶Ü</h2></div>
                        <div v-if="filteredHistory.length === 0" class="empty-state"><p>Á©∫Ê∞î‰∏≠ËøòÊú™Áïô‰∏ãËØçËØ≠ÁöÑÈ¶ôÊ∞î...</p></div>
                        <div class="gallery-list">
                            <div v-for="item in filteredHistory" :key="item.id" class="gallery-row-item glass-morphism" @click="loadWord(item)">
                                <div class="row-left"><span class="row-word">{{ item.word }}</span><span class="row-reading">{{ item.reading }}</span></div>
                                <div class="row-right"><button class="row-del-btn" @click.stop="deleteGalleryItem(item.id)">üóëÔ∏è</button></div>
                            </div>
                        </div>
                    </div>

                    <div v-else-if="mode === 'card'" class="content-area" key="card">
                        <div class="card-3d-wrapper" @click="isFlipped = !isFlipped">
                            <div class="card-body" :class="{ 'is-flipped': isFlipped }">
                                <div class="card-face front glass-morphism artistic-border">
                                    <div class="img-header" :class="{ 'loading': imageLoading }">
                                        <img :src="card.imageUrl" class="cover-img" @error="handleImageError" @load="imageLoading = false">
                                        <div v-if="imageLoading" class="img-loading-spinner"><i class="fa-solid fa-circle-notch fa-spin"></i></div>
                                    </div>
                                    <div class="text-content custom-scroll">
                                        <div class="word-display"><h2 class="main-word">{{ card.word }}</h2><div class="pronunciation"><span>{{ card.reading }}</span></div></div>
                                        <p class="simple-en">{{ card.simple_english }}</p>
                                        <div class="flip-hint">ÈóªÈ¶ôËØÜ‰πâ ‚û°Ô∏è</div>
                                    </div>
                                </div>
                                <div class="card-face back glass-morphism artistic-border">
                                    <div class="back-scroll custom-scroll">
                                        <div class="info-block meaning"><span class="label">Èáä‰πâ</span><div class="html-content" v-html="card.meaning"></div></div>
                                        <div v-if="card.etymology" class="info-block etymology"><span class="label">ËØçÊ∫ê</span><p>{{ card.etymology }}</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-else-if="mode === 'history'" class="history-stage glass-morphism artistic-border" key="history">
                         <div class="history-top"><h1 :style="{ color: langConfig[currentLang].accent }">ÂéÜÂè≤Âπ¥Ë°®</h1></div>
                         <div class="timeline-wrapper custom-scroll">
                             <div v-for="group in groupedTimelines" :key="group.year" class="year-group">
                                 <div class="t-year-label"><span class="year-number">{{ group.year }}</span></div>
                                 <div class="events-container">
                                     <div v-for="item in group.events" :key="item.id" class="t-content artistic-border">{{ item.event }}</div>
                                 </div>
                             </div>
                         </div>
                    </div>
                </Transition>
            </main>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;
        createApp({
            setup() {
                const showCover = ref(true);
                function enterApp() { showCover.value = false; }

                const currentLang = ref('jp');
                const wordInput = ref('');
                const loading = ref(false);
                const imageLoading = ref(false);
                const neroState = ref('idle');
                const isFlipped = ref(false);
                const history = ref([]);
                const mascotInput = ref(null);

                const reviewCounts = ref(JSON.parse(localStorage.getItem('memori-review-counts') || '{}'));

                // ÊõøÊç¢‰∏∫ÁΩëÁªúÂç†‰ΩçÂõæÔºåÈò≤Ê≠¢Êú¨Âú∞ÂõæÁâáÁº∫Â§±
                const shibaImages = { idle: 'https://media.tenor.com/2nJ1jW7kXp0AAAAi/shiba-inu-dog.gif', thinking: 'https://media.tenor.com/2nJ1jW7kXp0AAAAi/shiba-inu-dog.gif', happy: 'https://media.tenor.com/2nJ1jW7kXp0AAAAi/shiba-inu-dog.gif' };
                const userCat = ref('https://placekitten.com/200/200');
                const coverImages = { bg: 'https://images.unsplash.com/photo-1528164344705-47542687000d?auto=format&fit=crop&w=1600&q=80', cat: 'https://placekitten.com/400/400' };
                
                const mode = ref('gallery');
                const reviewQueue = ref([]);
                const reviewCard = ref(null);
                const showReviewAnswer = ref(false);
                const historyTab = ref('asia');
                
                // ... (timeline data omitted for brevity, logic fixed) ...
                const timelines = ref({
                    asia: [{ id: 1, year: 'Ââç7000', event: 'Ê≤≥ÂßÜÊ∏°ÊñáÂåñ', tag: 'üá®üá≥' }],
                    europe: [{ id: 2, year: '1789', event: 'Ê≥ïÂõΩÂ§ßÈù©ÂëΩ', tag: 'üá´üá∑' }]
                });

                const unifiedFont = "'Zen Old Mincho', serif";
                const langConfig = {
                    jp: { name: 'Êó•ËØ≠', scent: 'Ê®±‰∏éÂíåÁ∫∏', plant: 'cherry blossom', flag: 'üáØüáµ', voice: 'ja-JP', bg: '#F9F1F0', accent: '#CB3A56', font: unifiedFont },
                    // ... other langs simplified ...
                };
                const card = ref({ id: Date.now(), word: 'Memori', reading: 'me-mo-ri', meaning: 'Ê¨¢ËøéÊù•Âà∞ËØ≠Ë®ÄËÄÉÂè§ÂèëÊéòÁé∞Âú∫', imageUrl: 'https://images.unsplash.com/photo-1535905557558-afc4877a26fc?auto=format&fit=crop&w=800&q=80', isImageLocked: false, examples: [], lang: 'jp', nextReview: 0, interval: 0, isCollected: false });
                
                const filteredHistory = computed(() => history.value);
                const currentReviewCount = computed(() => 0);
                const flowerField = computed(() => []);
                const treeStage = computed(() => ({ img: 'https://via.placeholder.com/150' }));
                const groupedTimelines = computed(() => { return timelines.value.asia.map(t => ({year: t.year, events: [t]})) });

                onMounted(() => {
                    const savedBook = localStorage.getItem('memori-book');
                    if (savedBook) history.value = JSON.parse(savedBook);
                });

                function handleImageError(e) { e.target.src = 'https://via.placeholder.com/400x600?text=Image+Error'; }
                function speak(text) { console.log("Speaking:", text); } // Mock speak
                function toggleCollect() { /* ... logic ... */ }
                
                // MOCK API FUNCTION (Ê®°ÊãüÂêéÁ´Ø)
                async function generateCard() {
                    if (!wordInput.value) return;
                    loading.value = true;
                    setTimeout(() => {
                        // Ê®°ÊãüËøîÂõûÊï∞ÊçÆ
                        const mockData = {
                            word: wordInput.value,
                            reading: 'Mock Reading',
                            meaning: 'This is a mock definition because the backend is missing.',
                            simple_english: 'Mock Translation',
                            etymology: 'Mock Etymology',
                            imageUrl: 'https://images.unsplash.com/photo-1507842217153-e56f45d871fd?auto=format&fit=crop&w=800&q=80'
                        };
                        card.value = { ...mockData, id: Date.now(), lang: currentLang.value };
                        history.value.push(card.value);
                        mode.value = 'card';
                        loading.value = false;
                        wordInput.value = '';
                    }, 1000);
                }

                return {
                    showCover, enterApp, currentLang, wordInput, loading, imageLoading, neroState, isFlipped, history, mascotInput, reviewCounts, shibaImages, userCat, coverImages, mode, card, filteredHistory, langConfig, handleImageError, speak, generateCard, groupedTimelines, flowerField, treeStage, currentReviewCount
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
